
/* --- style.css (Improved for qoqer.txt - v1.8.1 - Background Transparency) --- */

/* --- :root Variables (Light Theme Defaults) --- */
:root {
    /* --- Colors --- */
    --sacred-gold: #D4AF37;
    --royal-purple: #5D3FD3;
    --prophet-blue: #1E3F66;
    --wisdom-silver: #C0C0C0;
    --apocalypse-red: #8B0000; /* Used for delete buttons */
    --gospel-white: #FFF9F0; /* Slightly off-white */
    --scripture-black: #1A1A1A;

    /* Testament Colors */
    --testament-old: #5D3FD3; /* Royal Purple */
    --testament-new: #D4AF37; /* Sacred Gold */
    --apocrypha: #8B4513; /* Saddle Brown */
    --other-testament: #6c757d; /* Gray for OTHER */

    /* Interaction & Highlights */
    --highlight-bg: rgba(22, 175, 55, 0.4); /* Lighter gold for target verse */
    --user-highlight-yellow: rgba(255, 255, 0, 0.5);
    --user-highlight-pink: rgba(255, 182, 193, 0.5);
    --user-highlight-lightblue: rgba(173, 216, 230, 0.5);
    --user-highlight-lightgreen: rgba(144, 238, 144, 0.5);
    --user-highlight-orange: rgba(255, 165, 0, 0.5);
    --user-highlight-focus-yellow: rgba(255, 255, 0, 0.7);
    --user-highlight-focus-pink: rgba(255, 182, 193, 0.7);
    --user-highlight-focus-lightblue: rgba(173, 216, 230, 0.7);
    --user-highlight-focus-lightgreen: rgba(144, 238, 144, 0.7);
    --user-highlight-focus-orange: rgba(255, 165, 0, 0.8); /* Slightly more opaque for orange */
    --link-color: var(--prophet-blue);
    --link-hover-color: var(--sacred-gold);
    --trigger-bg-start: rgba(212, 175, 55, 0.1);
    --trigger-bg-end: rgba(212, 175, 55, 0.25);
    --trigger-icon-color: var(--sacred-gold);
    --trigger-hover-bg-start: rgba(212, 175, 55, 0.2);
    --trigger-hover-bg-end: rgba(212, 175, 55, 0.4);

    /* Variables for Selection Highlight */
    --selection-bg: rgba(212, 175, 55, 0.5); /* Subtle gold background for selected verses */
    --selection-border: var(--sacred-gold); /* Accent border for selected verses */

    /* ADDED: Variable for Verse Hover/Active Background */
    --verse-hover-bg: #e9ecef; /* Light grey for hover/active in light mode */


    /* New Variables for Recent Theme */
    --recent-theme-color-light: #78909C; /* Light Blue Grey for Header/Accent */
    --recent-theme-border-light: #607D8B; /* Darker Blue Grey for Border */
    --recent-theme-text-on-grad-light: white; /* Text on Recent Header (Light) */
    --recent-book-bg-light: #ECEFF1; /* Lighter background for recent book cards */
    --recent-book-link-light: #37474F; /* Darker text for links/titles */
    --recent-book-link-hover-light: #546E7A; /* Hover color for links */


    /* --- Fonts --- */
    --font-ui: 'Inter', sans-serif;
    --font-reading: 'EB Garamond', serif;

    /* --- Spacing --- */
    --space-xs: 4px;
    --space-sm: 8px;
    --space-md: 16px;
    --space-lg: 24px;
    --space-xl: 32px;

    /* --- Dynamic UI Colors (Light Mode) --- */
    --bg-main: #f8f5ee; /* Light parchment */
    --bg-card: white; /* Default card background (not used for theme-card itself anymore) */
    --bg-nav: #f8f5ee; /* Same as main for top/bottom */
    --bg-reading: #fdfbf5; /* Slightly different for reading area */
    --bg-subtle: #f1f3f5; /* Lighter grey for cross-ref panel, textareas */
    --bg-button: #e9ecef;
    --bg-button-hover: #dee2e6;
    --bg-button-primary: var(--sacred-gold);
    --bg-button-primary-hover: #c79e2f; /* Darker gold */
    --bg-header-grad: linear-gradient(135deg, var(--prophet-blue), var(--royal-purple)); /* Kept for reading header, recent card header */

    --text-main: var(--scripture-black);
    --text-muted: #555;
    --text-on-accent: var(--scripture-black); /* Text on gold buttons */
    --text-on-primary: var(--scripture-black); /* Text on primary buttons */
    --text-on-grad: white; /* Text on header gradient */
    --text-button: #333;
    --text-button-primary: var(--scripture-black); /* Text on primary button */
    --text-danger: var(--apocalypse-red);

    --border-main: #e0dacc; /* Light brownish gray */
    --border-light: #eee;
    --border-accent: var(--sacred-gold);
    --border-primary: var(--sacred-gold);

    --shadow-color: rgba(0, 0, 0, 0.07);
    --progress-bar-color: var(--sacred-gold);

    /* --- Transitions --- */
    --transition-fast: 0.2s ease;
    --transition-med: 0.4s ease;
    --transition-slow: 0.6s ease;
}

/* --- Dark Mode Overrides --- */
body.dark-mode {
    /* --- Dynamic UI Colors (Dark Mode) --- */
    --bg-main: #121212;
    --bg-card: #2a2a2a; /* Default card background (not used for theme-card itself anymore) */
    --bg-nav: #1f1f1f;
    --bg-reading: #1a1d21;
    --bg-subtle: #212529; /* Darker grey for cross-ref, textareas */
    --bg-button: #444;
    --bg-button-hover: #555;
    --bg-button-primary: var(--sacred-gold);
    --bg-button-primary-hover: #f0c44c; /* Lighter gold */
    --bg-header-grad: linear-gradient(135deg, #1a1a1a, #2a2a2a); /* Adjusted dark mode gradient */

    --text-main: #e8e8e8;
    --text-muted: #aaa;
    /* --text-on-accent: var(--scripture-black); */ /* Keep dark for gold contrast */
    /* --text-on-primary: var(--scripture-black); */ /* Keep dark for gold contrast */
    --text-on-grad: #e8e8e8;
    --text-button: #eee;
    /* --text-button-primary: var(--scripture-black); */ /* Keep dark for gold contrast */
    --text-danger: #ff8a8a; /* Lighter red for dark mode */

    --border-main: #3a3f47;
    --border-light: #404040;
    /* --border-accent: var(--testament-new); */ /* Gold remains accent */
    /* --border-primary: var(--testament-new); */ /* Gold remains accent */

    --shadow-color: rgba(0, 0, 0, 0.3);
    /* --progress-bar-color: var(--testament-new); */

    /* Interaction & Highlights */
    --highlight-bg: rgba(000, 175, 55, 0.4); /* Temporary tap highlight color in dark mode */
    --user-highlight-yellow: rgba(212, 175, 55, 0.6);
    --user-highlight-pink: rgba(255, 150, 163, 0.6);
    --user-highlight-lightblue: rgba(130, 190, 210, 0.6);
    --user-highlight-lightgreen: rgba(100, 210, 100, 0.6);
    --user-highlight-orange: rgba(255, 140, 0, 0.7); /* Slightly more opaque */
    --user-highlight-focus-yellow: rgba(212, 175, 55, 0.8);
    --user-highlight-focus-pink: rgba(255, 150, 163, 0.8);
    --user-highlight-focus-lightblue: rgba(130, 190, 210, 0.8);
    --user-highlight-focus-lightgreen: rgba(100, 210, 100, 0.8);
    --user-highlight-focus-orange: rgba(255, 140, 0, 0.9); /* Slightly more opaque */

    /* Variables for Selection Highlight */
    --selection-bg: rgba(212, 175, 55, 0.3); /* Subtle gold background for selected verses in dark mode */
    --selection-border: var(--sacred-gold); /* Accent border for selected verses in dark mode */

    /* ADDED: Variable for Verse Hover/Active Background in Dark Mode */
    --verse-hover-bg: rgba(255, 255, 255, 0.05); /* Subtle white transparent for hover/active in dark mode */


    --link-color: var(--sacred-gold);
    --link-hover-color: #f0c44c;
    --trigger-bg-start: rgba(212, 175, 55, 0.15);
    --trigger-bg-end: rgba(212, 175, 55, 0.3);
    /* --trigger-icon-color: var(--sacred-gold); */
    --trigger-hover-bg-start: rgba(212, 175, 55, 0.25);
    --trigger-hover-bg-end: rgba(212, 175, 55, 0.45);

    /* Testament Colors (adjust if needed for contrast) */
    --testament-old: #aabfff; /* Lighter purple */
    /* --testament-new: var(--sacred-gold); */
    --apocrypha: #d2a679; /* Lighter brown */
    --other-testament: #adb5bd;

    /* New Variables for Recent Theme (Dark Mode) */
    --recent-theme-color-dark: #455A64; /* Dark Blue Grey */
    --recent-theme-border-dark: #607D8B; /* Lighter Blue Grey */
    --recent-theme-text-on-grad-dark: white; /* Text on Recent Header (Dark) */
    --recent-book-bg-dark: #263238; /* Darker background for recent book cards */
    --recent-book-link-dark: #90A4AE; /* Lighter text for links/titles */
    --recent-book-link-hover-dark: #B0BEC5; /* Even lighter hover */

    /* NEW Variables for Dark Mode Cross-Ref Trigger Button */
    --trigger-bg-start-dark: rgba(100, 100, 100, 0.15);  /* Dark grey, semi-transparent */
    --trigger-bg-end-dark: rgba(120, 120, 120, 0.3);    /* Slightly lighter dark grey */
    --trigger-icon-color-dark: #b0b0b0;                 /* Light grey for the dot */
    --trigger-border-color-dark-hover: #888888;         /* Border color on hover/focus */
    --trigger-hover-bg-start-dark: rgba(120, 120, 120, 0.25);
    --trigger-hover-bg-end-dark: rgba(140, 140, 140, 0.4);
    --trigger-dot-color-dark-hover: #cccccc;            /* Lighter grey dot on hover */
    --trigger-focus-ring-dark: rgba(150, 150, 150, 0.3); /* Focus ring color */
}
/* --- Base & Layout --- */
* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; font-size: 16px; }
body { font-family: var(--font-ui); background: var(--bg-main); color: var(--text-main); min-height: 100vh; line-height: 1.6; transition: background var(--transition-med), color var(--transition-med); display: flex; flex-direction: column; }
body.app-loading::after { content: 'Loading App...'; position: fixed; top: 45%; left: 50%; transform: translateX(-50%); font-size: 1.2rem; padding: var(--space-md) var(--space-lg); background: rgba(0, 0, 0, 0.7); color: white; border-radius: 8px; z-index: 1000; }
.app-container { display: flex; flex-direction: column; min-height: 100vh; width: 100%; }
/* REMOVED: .header styles */
/*
.header { text-align: center; padding: var(--space-md) var(--space-lg); background: var(--bg-header-grad); color: var(--text-on-grad); box-shadow: 0 4px 12px var(--shadow-color); position: sticky; top: 0; left: 0; width: 100%; z-index: 50; flex-shrink: 0; }
.header h1 { font-size: clamp(1.8rem, 5vw, 2.5rem); font-weight: 500; margin-bottom: var(--space-xs); font-family: var(--font-reading); }
.header p { font-style: italic; opacity: 0.9; font-size: clamp(0.9rem, 2.5vw, 1rem); }
*/
.main-app-content { flex: 1; padding: var(--space-lg) var(--space-md); max-width: 1600px; margin: 0 auto; width: 100%; background: var(--bg-main); /* Keep main content background for other views */ }

/* --- Utility Classes --- */
.hidden { display: none !important; }
.visually-hidden { position: absolute !important; height: 1px; width: 1px; overflow: hidden; clip: rect(1px, 1px, 1px, 1px); white-space: nowrap; }
*:focus-visible { outline: 2px solid var(--link-color); outline-offset: 2px; box-shadow: 0 0 0 4px rgba(0, 119, 255, 0.3); }
body.dark-mode *:focus-visible { outline-color: var(--link-hover-color); box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.4); }
*:focus:not(:focus-visible) { outline: none; }

/* --- General Button Styles --- */
.button-primary, .button-secondary {
    display: inline-block;
    padding: var(--space-sm) var(--space-md);
    font-size: 1rem;
    font-weight: 500;
    border-radius: 6px;
    cursor: pointer;
    text-align: center;
    transition: all var(--transition-fast);
    border: 1px solid transparent;
    line-height: 1.4; /* Adjust line height for consistency */
    white-space: nowrap;
}
.button-primary {
    background-color: var(--bg-button-primary);
    color: var(--text-button-primary);
    border-color: var(--border-primary);
}
.button-primary:hover:not(:disabled), .button-primary:focus:not(:disabled) {
    background-color: var(--bg-button-primary-hover);
    box-shadow: 0 2px 5px var(--shadow-color);
}
.button-secondary {
    background-color: var(--bg-button);
    color: var(--text-button);
    border-color: var(--border-main);
}
.button-secondary:hover:not(:disabled), .button-secondary:focus:not(:disabled) {
    background-color: var(--bg-button-hover);
    border-color: var(--border-accent);
}
.button-primary:disabled, .button-secondary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* --- Danger Button Style --- */
.button-danger {
    background-color: var(--apocalypse-red); /* Use apocalypse-red */
    color: white; /* White text on red */
    border-color: var(--apocalypse-red);
}
.button-danger:hover:not(:disabled), .button-danger:focus:not(:disabled) {
    background-color: #a00000; /* Darker red */
    border-color: #a00000;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}
body.dark-mode .button-danger {
     background-color: var(--text-danger); /* Use lighter red for dark mode */
     border-color: var(--text-danger);
     color: var(--scripture-black); /* Keep text dark for contrast */
}
body.dark-mode .button-danger:hover:not(:disabled), body.dark-mode .button-danger:focus:not(:disabled) {
    background-color: #ffaaaa; /* Even lighter red */
    border-color: #ffaaaa;
}

/* Adjust settings button style in dark mode if needed */
body.dark-mode .settings-section button.link-button:hover, body.dark-mode .settings-section button.link-button:focus,
body.dark-mode .settings-section button.button-secondary:hover, body.dark-mode .settings-section button.button-secondary:focus {
     /* Ensure focus/hover on other buttons is distinct from danger */
     border-color: var(--border-accent); /* Example: Revert to accent color */
     background: var(--bg-button-hover);
     color: var(--link-hover-color);
}


/* --- Tab System --- */
.view-tabs-container, .content-tabs { border-bottom: 1px solid var(--border-main); margin-bottom: var(--space-lg); overflow-x: auto; white-space: nowrap; scrollbar-width: none; -ms-overflow-style: none; background: var(--bg-nav); }
.view-tabs-container::-webkit-scrollbar, .content-tabs::-webkit-scrollbar { display: none; }
.view-tabs, .content-tabs > [role="tablist"] { display: inline-flex; padding: 0 var(--space-sm); }
.view-tabs [role="tab"], .content-tabs [role="tab"], .bottom-nav [role="tab"] { font-family: var(--font-ui); padding: var(--space-sm) var(--space-md); margin: 0; border: none; border-bottom: 3px solid transparent; background: none; color: var(--text-muted); cursor: pointer; transition: all var(--transition-fast); font-size: 1rem; font-weight: 500; text-align: center; white-space: nowrap; flex-shrink: 0; }
.view-tabs [role="tab"][aria-selected="true"], .content-tabs [role="tab"][aria-selected="true"], .bottom-nav [role="tab"][aria-selected="true"] { color: var(--border-accent); border-bottom-color: var(--border-accent); }
.view-tabs [role="tab"]:not([aria-selected="true"]):hover, .content-tabs [role="tab"]:not([aria-selected="true"]):hover, .bottom-nav [role="tab"]:not([aria-selected="true"]):hover { color: var(--link-color); border-bottom-color: var(--link-color); }
body.dark-mode .view-tabs [role="tab"]:not([aria-selected="true"]):hover, body.dark-mode .content-tabs [role="tab"]:not([aria-selected="true"]):hover, body.dark-mode .bottom-nav [role="tab"]:not([aria-selected="true"]):hover { color: var(--link-hover-color); border-bottom-color: var(--link-hover-color); }
.tab-content { padding-top: 0; }
[role="tabpanel"] { display: block; animation: fadeIn 0.5s ease forwards; }
[role="tabpanel"].hidden { display: none; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

/* --- Bottom Navigation (Mobile) --- */
.bottom-nav { display: none; position: fixed; bottom: 0; left: 0; right: 0; height: 60px; background: var(--bg-nav); border-top: 1px solid var(--border-main); box-shadow: 0 -2px 10px var(--shadow-color); z-index: 60; }
.bottom-nav[aria-hidden="false"] { display: flex; } /* Show based on aria-hidden */
.bottom-nav [role="tablist"] { display: flex; justify-content: space-around; align-items: stretch; width: 100%; }
.bottom-nav [role="tab"] { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: var(--space-xs) 0; font-size: 0.75rem; line-height: 1.2; border-bottom-width: 0; border-top: 3px solid transparent; }
.bottom-nav [role="tab"] .icon { font-size: 1.4rem; margin-bottom: 2px; line-height: 1; }
.bottom-nav [role="tab"][aria-selected="true"] { border-top-color: var(--border-accent); border-bottom-color: transparent; color: var(--border-accent); }
.bottom-nav [role="tab"]:not([aria-selected="true"]):hover { border-bottom-color: transparent; color: var(--link-color); }
body.dark-mode .bottom-nav [role="tab"]:not([aria-selected="true"]):hover { color: var(--link-hover-color); }

/* --- Theme View Specific --- */
#themeView {
     /* This is where the background image will be applied by JS */
     /* It needs to override the .main-app-content background */
     /* Add transitions if you want a fade effect (more complex) */
     /* transition: background-image 0.5s ease; */
     /* Add padding/margin adjustments if the background makes text hard to read near edges */
     /* padding: var(--space-lg) var(--space-md); */ /* Ensure padding is sufficient */
     /* Position relative for the pseudo-element overlay */
     position: relative;
     z-index: 0; /* Ensure it's below its content */
}

/* Style specific background properties when image is applied */
/* Ensure the content elements (cards) are above the background */
#themeView > * {
    position: relative;
    z-index: 1;
}


/* Optional: Add a pseudo-element overlay for better text readability on images */
#themeView[style*="background-image"]::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.3); /* Darken light images */
    z-index: -1; /* Behind content */
    pointer-events: none; /* Allow clicks to pass through */
    transition: background-color var(--transition-med);
}

body.dark-mode #themeView[style*="background-image"]::before {
     background-color: rgba(0, 0, 0, 0.5); /* Maybe slightly more darkening in dark mode */
}


.theme-cards-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(min(100%, 320px), 1fr)); gap: var(--space-lg);
margin-top: 1.2
;
    /* ADDED: Explicitly set z-index to ensure its stacking context is below the verse-card */
    z-index: 0;
}

/* --- style.css --- */


/* Find this rule */
.theme-card {
    /* REMOVED: background: var(--bg-card); */ /* <-- This was removed previously */
    border-radius: 12px;
    box-shadow: 0 5px 15px var(--shadow-color);
    /* MODIFIED: Add 'opacity' to the transition list */
    transition: box-shadow var(--transition-med), transform var(--transition-med), opacity var(--transition-fast); /* <-- Added opacity */
    border-top: 4px solid var(--border-accent);
    display: flex;
    flex-direction: column;
    overflow: hidden; /* Important to clip content when collapsed */
    position: relative; /* Needed for z-index context */
    /* Kept z-index: 1. Its stacking context is relative to .theme-cards-container (z-index: 0) */
    z-index: 1;
}
/* Keep hover/focus-within effects */
.theme-card:hover, .theme-card:focus-within {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px var(--shadow-color);
    /* Hover/focus might slightly increase opacity if you want, e.g., opacity: 0.95; */
}


/* ADD THIS NEW RULE: Apply transparency when the card is NOT active (collapsed) */
.theme-card:not(.active) {
    opacity: 0.7; /* <-- Adjust this value (e.g., 0.8, 0.85, 0.9, 0.95). Lower means more transparent. */
}


/* Find this rule */
/* Ensure the card is fully opaque when it IS active (expanded) */
.theme-card.active {
    /* MODIFIED: Explicitly set opacity to 1 */
    opacity: 1; /* <-- Ensure full opacity when expanded */
    /* Keep the rest of the styles for this rule */
}
/* The .theme-card.active .theme-card-content rule remains the same */
.theme-card.active .theme-card-content {
    padding: var(--space-md);
    max-height: 1000px;
    background: transparent; /* This should already be transparent */
}

/* The rest of your CSS remains the same */
/* ... (rest of style.css) ... */

/* Remember to apply the modified .intro-text style from the previous step within theme-card.active .theme-card-content */
.theme-card.active .theme-card-content .intro-text {
    /* ... styles for background, padding, color, display: inline-block, box-decoration-break ... */
}
/* Keep hover/focus-within effects */
.theme-card:hover, .theme-card:focus-within { transform: translateY(-5px); box-shadow: 0 10px 25px var(--shadow-color); }

/* Keep header opaque */
.theme-card-header { padding: var(--space-md); background: var(--bg-header-grad); color: var(--text-on-grad); position: relative; border-radius: 7px 7px 0 0; cursor: pointer; z-index: 2; /* Ensure header is above transparent content */ }
.theme-card-header h2 { margin: 0; font-weight: 500; font-size: 1.3rem; letter-spacing: 0.5px; }
.theme-card-header .subtitle { font-style: italic; opacity: 0.9; font-size: 0.9rem; margin-top: var(--space-xs); font-weight: 300; }
.scripture-icon { position: absolute; right: var(--space-md); top: 50%; transform: translateY(-50%); font-size: 1.8rem; opacity: 0.15; pointer-events: none; transition: opacity var(--transition-fast); }
body.dark-mode .scripture-icon { opacity: 0.25; }

/* MODIFIED: Make content area transparent by default */
.theme-card-content {
    padding: 0 var(--space-md); /* No vertical padding when collapsed */
    max-height: 0;
    overflow: hidden;
    /* Use max-height for animation */
    transition: max-height var(--transition-slow) ease-in-out;
    background: transparent; /* <-- Set this to transparent */
    border-radius: 0 0 7px 7px;
    /* Remove padding transition here, as padding is 0 when collapsed */
    /* transition: max-height var(--transition-slow) ease-in-out, padding-top var(--transition-slow) ease-in-out, padding-bottom var(--transition-slow) ease-in-out; */
    z-index: 1; /* Ensure content is below header but above themeView background */
}

/* MODIFIED: Add padding back and ensure transparency when the card is active */
.theme-card.active .theme-card-content {
    padding: var(--space-md); /* <-- Apply padding here when active */
    max-height: 1000px; /* Adjust max-height as needed */
    background: transparent; /* <-- Ensure it stays transparent when active */
}

/* The children opacity/transform animation remains the same */
.theme-card-content > * { opacity: 0; transform: translateY(-10px); transition: opacity calc(var(--transition-slow) * 0.6) ease-out calc(var(--transition-slow) * 0.3), transform calc(var(--transition-slow) * 0.6) ease-out calc(var(--transition-slow) * 0.3); }
.theme-card.active .theme-card-content > * { opacity: 1; transform: translateY(0); }

/* The books container holds the grid, sits within the transparent content */
.books-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: var(--space-sm); margin-top: var(--space-md); }
/* Ensure book cards have solid backgrounds */
.book-card { background: var(--bg-main); border-radius: 8px; padding: var(--space-sm); text-align: center; box-shadow: 0 2px 5px var(--shadow-color); transition: all var(--transition-fast); border: 1px solid var(--border-light); cursor: pointer; position: relative; overflow: hidden; z-index: 3; /* Ensure book cards are above content and background */ }
body.dark-mode .book-card { background: #333; border-color: var(--border-main); }
.book-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--border-accent); opacity: 0.6; transition: opacity var(--transition-fast), width var(--transition-fast); }
.book-card:hover, .book-card:focus { transform: translateY(-3px); box-shadow: 0 4px 10px var(--shadow-color); border-color: var(--border-accent); }
.book-card:hover::before, .book-card:focus::before { opacity: 1; width: 6px; }
.book-card h3 { font-size: 0.9rem; font-weight: 500; color: var(--link-color); margin-bottom: 2px; }
body.dark-mode .book-card h3 { color: var(--link-color); }
.book-card .testament { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; display: block; opacity: 0.8; }
.book-card .old-testament { color: var(--testament-old); }
.book-card .new-testament { color: var(--testament-new); }
.book-card .apocrypha { color: var(--apocrypha); }
.book-card .other-testament { color: var(--other-testament); }

/* MODIFIED: Style for .intro-text when card is active */
/* Use a more specific selector to ensure this only applies within the expanded card content */
.theme-card.active .theme-card-content .intro-text {
    /* Ensure it's visible and readable, overriding potential parent transitions */
    opacity: 1;
    transform: none;

    /* Crucial: Make it inline-block so background/padding wrap with text lines */
    display: inline-block; /* <-- ADD THIS LINE */

    /* Add a subtle background for readability */
    /* Using a semi-transparent browny/parchment tone for light mode */
    /* We'll use the same colors and transparency as the last step */
    background-color: rgba(160, 130, 80, 0.5); /* Browny tone + 50% transparent */
    color: var(--text-main); /* Ensure good contrast with the subtle background */

    /* Keep padding minimal to hug the text closely */
    padding: 1px 3px; /* 1px top/bottom, 3px left/right */

    /* Keep border radius */
    border-radius: 3px;

    /* Keep font style and line height */
    font-style: italic;
    line-height: 1.5;

    /* This is necessary *with* inline-block for per-line wrapping of padding/background */
    box-decoration-break: clone;
    -webkit-box-decoration-break: clone;

    /* Add bottom margin to separate it from the book cards below */
    /* Note: margin-bottom on inline-block might be tricky, but usually works before a block sibling */
    margin: 0 0 var(--space-md) 0; /* Keep bottom margin */

    /* Optional: Add a very subtle text shadow as a fallback or additional layer */
    /* text-shadow: 1px 1px 2px rgba(0,0,0,0.2); */
}

body.dark-mode .theme-card.active .theme-card-content .intro-text {
    /* Adjust background for dark mode */
    background-color: rgba(60, 50, 40, 0.5); /* Dark browny tone + 50% transparent */
    color: var(--text-main); /* Ensure good contrast */

    /* Optional: Adjust text shadow for dark mode */
    /* text-shadow: 1px 1px 2px rgba(255,255,255,0.2); */
}

/* Ensure the default .intro-text rule doesn't interfere when collapsed */
.intro-text {
    /* When not active, it should behave like a normal block element (default for <p>) */
    /* and have opacity: 0 and transform set for the collapse transition */
    /* Do NOT set display: inline-block here */
    /* Make sure no background, padding, or box-shadow is applied here */
    /* ... existing styles for non-active state opacity/transform ... */
}

/* --- NEW: Recent Theme Card Specific Styles --- */
/* Inherits transparency from .theme-card and .theme-card-content */
.theme-card.recent-theme-card {
    border-top-color: var(--recent-theme-border-light); /* Use specific border color */
    margin-bottom: var(--space-lg); /* Add margin below */
    border-bottom: 1px solid var(--border-main); /* Subtle visual separator */
}
.recent-theme-card .theme-card-header {
    background: linear-gradient(135deg, var(--recent-theme-color-light), var(--recent-theme-border-light)); /* Unique gradient */
    color: var(--recent-theme-text-on-grad-light); /* Text color for header */
}
body.dark-mode .recent-theme-card {
     border-top-color: var(--recent-theme-border-dark);
     border-bottom-color: var(--border-main);
}
body.dark-mode .recent-theme-card .theme-card-header {
    background: linear-gradient(135deg, var(--recent-theme-border-dark), var(--recent-theme-color-dark)); /* Adjust dark mode gradient direction/colors */
    color: var(--recent-theme-text-on-grad-dark);
}
.recent-theme-card .scripture-icon {
    color: var(--recent-theme-text-on-grad-light); /* Match header text color */
    opacity: 0.3; /* Keep subtle */
}
body.dark-mode .recent-theme-card .scripture-icon {
    color: var(--recent-theme-text-on-grad-dark);
    opacity: 0.4;
}

/* Style for book cards *inside* the Recent theme card */
.recent-theme-card .book-card {
    border: 1px solid var(--border-main); /* Keep general border */
    border-left: 4px solid var(--recent-theme-border-light); /* Use Recent theme color for left border */
    background: var(--recent-book-bg-light); /* Lighter background for recent book cards */
}
body.dark-mode .recent-theme-card .book-card {
    background: var(--recent-book-bg-dark); /* Specific dark background for recent books */
    border-left-color: var(--recent-theme-border-dark);
}
.recent-theme-card .book-card:hover, .recent-theme-card .book-card:focus {
    border-color: var(--recent-theme-border-light); /* Highlight border on hover/focus */
    border-left-color: var(--recent-theme-border-light);
    transform: translateY(-3px);
    box-shadow: 0 4px 10px var(--shadow-color);
}
body.dark-mode .recent-theme-card .book-card:hover, body.dark-mode .recent-theme-card .book-card:focus {
    border-color: var(--recent-theme-border-dark); /* Highlight border on hover/focus */
    border-left-color: var(--recent-theme-border-dark);
}

.recent-theme-card .book-card h3 {
   color: var(--recent-book-link-light); /* Use new link color */
}
body.dark-mode .recent-theme-card .book-card h3 {
   color: var(--recent-book-link-dark);
}
.recent-theme-card .book-card:hover h3, .recent-theme-card .book-card:focus h3 {
    color: var(--recent-book-link-hover-light); /* Hover color for links */
}
body.dark-mode .recent-theme-card .book-card:hover h3, body.dark-mode .recent-theme-card .book-card:focus h3 {
    color: var(--recent-book-link-hover-dark); /* Corrected variable name */
}
.recent-theme-card .book-card .testament {
    color: var(--text-muted); /* Keep muted color for testament within recent */
}
body.dark-mode .recent-theme-card .book-card .testament {
    color: var(--text-muted);
}
.recent-empty-message {
     padding: var(--space-md) 0; /* Add some padding */
     font-style: italic;
     color: var(--text-muted);
     text-align: center;
}
.recent-theme-card.active .theme-card-content .books-container {
    margin-top: 0; /* Remove top margin if books container is directly inside */
}

/* Add a small border/margin separation visually below the Recent card */
.recent-theme-card {
    margin-bottom: var(--space-lg);
}
/* Ensure the next card isn't right against it if Recent is the first */
.theme-cards-container > .theme-card:first-child { /* This targets the recent card */
     /* Handled by margin-bottom on .recent-theme-card */
}


/* --- Book List View --- */
#bookListView {
    /* Ensure this uses the main-app-content background */
    background: var(--bg-main);
}
#bookListView .tab-panel { padding-top: var(--space-sm); }
.book-list { list-style: none; padding: 0; margin: 0; }
.book-list-item { background: var(--bg-card); margin-bottom: var(--space-sm); padding: var(--space-md); border-radius: 8px; border: 1px solid var(--border-main); cursor: pointer; transition: all var(--transition-fast); display: flex; justify-content: space-between; align-items: center; font-weight: 500; color: var(--text-main); }
.book-list-item:hover, .book-list-item:focus { border-color: var(--border-accent); transform: translateX(4px); box-shadow: 3px 3px 10px var(--shadow-color); color: var(--link-color); }
body.dark-mode .book-list-item:hover, body.dark-mode .book-list-item:focus { color: var(--link-hover-color); }

/* Book List Search Styles */
#bookListSearchContainer { padding: var(--space-sm) var(--space-md); border-bottom: 1px solid var(--border-main); background-color: var(--bg-nav); margin-bottom: var(--space-md); display: flex; align-items: center; gap: var(--space-sm); }
#bookListSearchInput { flex-grow: 1; padding: var(--space-sm) var(--space-md); border: 1px solid var(--border-main); border-radius: 6px; font-size: 1rem; background: var(--bg-card); color: var(--text-main); }
#bookListSearchInput:focus { border-color: var(--border-accent); box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.3); }
#bookListSearchButton { /* Uses .button-primary */ flex-shrink: 0; }
#bookListClearSearchButton { /* Uses .button-secondary */ font-size: 1.2em; line-height: 1; padding: var(--space-xs) var(--space-sm); min-width: 36px; flex-shrink: 0; }
#bookListNoResults { display: none; margin: var(--space-lg) var(--space-md); text-align: center; font-style: italic; color: var(--text-muted); }
#bookListSearchResultsContainer { display: none; padding: var(--space-md); }
.search-results-heading { font-size: 1.1rem; font-weight: 500; color: var(--text-muted); margin-bottom: var(--space-md); padding-bottom: var(--space-sm); border-bottom: 1px solid var(--border-light); }
/* Styles for .search-result-item are reused from the main search view styles below */


/* --- Search View / Book List Search Results --- */
.search-result-item { background: var(--bg-card); border: 1px solid var(--border-main); border-left: 4px solid transparent; border-radius: 8px; padding: var(--space-md); margin-bottom: var(--space-md); cursor: pointer; transition: border-color var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast), border-left-color var(--transition-fast); }
.search-result-item:hover, .search-result-item:focus { border-left-color: var(--border-accent); box-shadow: 0 3px 10px var(--shadow-color); transform: translateX(2px); }
.result-header { font-weight: 600; margin-bottom: var(--space-sm); color: var(--link-color); font-size: 0.9rem; }
body.dark-mode .result-header { color: var(--link-color); }
.result-snippet { font-family: var(--font-reading); line-height: 1.7; font-size: 1rem; margin-bottom: var(--space-xs); }
.result-snippet mark { background-color: var(--highlight-bg); padding: 1px 3px; border-radius: 2px; color: var(--text-main); box-shadow: 0 0 0 1px var(--highlight-bg); }
body.dark-mode .result-snippet mark { background-color: var(--user-highlight-yellow); color: var(--scripture-black); box-shadow: 0 0 0 1px var(--user-highlight-yellow); }
.result-type-match { font-style: italic; color: var(--text-muted); font-size: 0.8em; margin-top: var(--space-xs); }
.no-results-message, .searching-message, .loading-dots { font-style: italic; color: var(--text-muted); padding: var(--space-md) 0; text-align: center; }
.loading-dots::after { content: ' .'; animation: dots 1s steps(5, end) infinite; }
@keyframes dots { 0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);} 40% { color: var(--text-muted); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);} 60% { text-shadow: .25em 0 0 var(--text-muted), .5em 0 0 rgba(0,0,0,0);} 80%, 100% { text-shadow: .25em 0 0 var(--text-muted), .5em 0 0 var(--text-muted);} }
body.dark-mode .loading-dots, body.dark-mode .loading-dots::after { color: var(--text-muted); }

/* --- Notes & Favourites View --- */
#notesView {
    max-width: 900px; /* Limit width */
    margin: 0 auto;
    /* Ensure this uses the main-app-content background */
    background: var(--bg-main);
}
.notes-view-panel { /* Common style for sub-panels */
    padding-top: var(--space-md); /* Spacing below tabs */
}
.user-item-list, .reflection-card-list { /* Common list styles */
    list-style: none;
    padding: 0;
    margin: 0;
}
.note-item, .favourite-item, .reflection-card { /* Common card style */
    background: var(--bg-card);
    border: 1px solid var(--border-main);
    border-radius: 8px;
    margin-bottom: var(--space-md);
    position: relative; /* For delete button positioning */
    overflow: hidden; /* Ensure children respect radius */
    transition: box-shadow var(--transition-fast), border-color var(--transition-fast);
}
.note-item:hover, .favourite-item:hover, .reflection-card:hover {
    box-shadow: 0 4px 12px var(--shadow-color);
    border-color: var(--border-light);
}
/* Common Item Content Area */
.note-item-content, .favourite-item-content {
    padding: var(--space-md);
    padding-right: 40px; /* Space for delete button */
    cursor: pointer;
    outline: none; /* Remove outline for div */
}
.note-item-content:focus-visible, .favourite-item-content:focus-visible { /* Add focus style */
    box-shadow: inset 0 0 0 2px var(--link-color);
}
body.dark-mode .note-item-content:focus-visible, body.dark-mode .favourite-item-content:focus-visible {
    box-shadow: inset 0 0 0 2px var(--link-hover-color);
}
/* Item Header */
.item-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: var(--space-sm);
    font-size: 0.9rem;
}
.item-ref {
    font-weight: 600;
    color: var(--link-color);
}
body.dark-mode .item-ref {
    color: var(--link-color);
}
.item-date {
    font-size: 0.8em;
    color: var(--text-muted);
    white-space: nowrap;
    margin-left: var(--space-sm);
}
/* Item Text */
.item-verse-text {
    font-family: var(--font-reading);
    margin-bottom: var(--space-sm);
    line-height: 1.6;
}
.item-user-note {
    background: var(--bg-subtle);
    padding: var(--space-sm);
    border-radius: 4px;
    font-size: 0.95em;
    border-left: 3px solid var(--border-accent);
}
body.dark-mode .item-user-note {
    background: var(--bg-subtle);
    border-left-color: var(--border-accent);
}
/* Delete Button */
.delete-item-button, .delete-reflection-button {
    position: absolute;
    top: var(--space-xs);
    right: var(--space-xs);
    width: 32px;
    height: 32px;
    line-height: 32px; /* Center 'x' */
    text-align: center;
    border: none;
    background: none;
    color: var(--text-muted);
    font-size: 1.5rem;
    font-weight: 300;
    cursor: pointer;
    border-radius: 50%;
    transition: all var(--transition-fast);
}
.delete-item-button:hover, .delete-item-button:focus,
.delete-reflection-button:hover, .delete-reflection-button:focus {
    color: var(--text-danger);
    background-color: rgba(139, 0, 0, 0.1); /* Light red bg */
}
body.dark-mode .delete-item-button:hover, body.dark-mode .delete-item-button:focus,
body.dark-mode .delete-reflection-button:hover, body.dark-mode .delete-reflection-button:focus {
     color: var(--text-danger);
     background-color: rgba(255, 138, 138, 0.15); /* Light red bg */
}
/* Empty List Message */
.empty-list-message {
    color: var(--text-muted);
    text-align: center;
    padding: var(--space-lg);
    font-style: italic;
}


/* --- Reflection Card System --- */
.reflection-toolbar {
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--border-main);
    margin-bottom: var(--space-md);
    text-align: left; /* Align button left */
}
#addNewReflectionButton .icon {
    margin-right: var(--space-xs);
}

/* Reflection Card Specifics */
.reflection-card {
    transition: all var(--transition-fast); /* Add transition for edit mode */
}
.reflection-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-sm) var(--space-md);
    background-color: var(--bg-subtle); /* Subtle header */
    border-bottom: 1px solid var(--border-light);
    cursor: pointer; /* Header is clickable */
}
body.dark-mode .reflection-card-header {
    background-color: #303030; /* Slightly different dark header */
    border-bottom-color: var(--border-main);
}
.reflection-date {
    font-size: 0.85em;
    font-weight: 500;
    color: var(--text-muted);
}
.reflection-card-controls {
    display: flex;
    gap: var(--space-sm);
}
.save-reflection-button { /* Uses .button-primary */
    padding: var(--space-xs) var(--space-sm); /* Smaller save button */
    font-size: 0.9em;
}
.delete-reflection-button {
    position: static; /* Override absolute positioning */
    width: 28px; height: 28px; line-height: 28px; /* Match size */
    font-size: 1.4rem; /* Match size */
}

/* Card Content Area (Display Mode) */
.reflection-content-display {
    padding: var(--space-md);
    line-height: 1.7;
    font-family: var(--font-reading); /* Match reading font */
    cursor: pointer; /* Indicate interactivity */
    outline: none;
    transition: max-height var(--transition-med) ease-out;
    overflow: hidden; /* Required for max-height transition */
}
.reflection-card.collapsed .reflection-content-display {
    max-height: 5em; /* Show a preview when collapsed */
    position: relative; /* For fade-out effect */
    padding-bottom: 1.5em; /* Space for fade */
}
.reflection-card.collapsed .reflection-content-display::after { /* Fade out effect */
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1.5em;
    background: linear-gradient(to bottom, transparent, var(--bg-card));
}
body.dark-mode .reflection-card.collapsed .reflection-content-display::after {
     background: linear-gradient(to bottom, transparent, var(--bg-card));
}

/* Placeholder text */
.empty-reflection-placeholder {
    color: var(--text-muted);
    font-style: italic;
}

/* Card Content Area (Textarea Edit Mode) */
.reflection-textarea {
    display: none; /* Hidden by default */
    width: 100%;
    border: none;
    padding: var(--space-md);
    font-family: var(--font-reading); /* Match reading font */
    font-size: 1em; /* Match display font size */
    line-height: 1.7;
    background-color: var(--bg-subtle);
    color: var(--text-main);
    min-height: 100px; /* Minimum height */
    resize: vertical; /* Allow vertical resizing */
    outline: none;
    border-radius: 0 0 8px 8px; /* Match card bottom radius */
}
body.dark-mode .reflection-textarea {
    background-color: var(--bg-subtle);
}
.reflection-textarea:focus {
    box-shadow: inset 0 0 0 2px var(--link-color);
}
body.dark-mode .reflection-textarea:focus {
    box-shadow: inset 0 0 0 2px var(--link-hover-color);
}

/* Reflection Card States */
.reflection-card.editing .reflection-card-header { cursor: default; } /* Header not clickable in edit */
.reflection-card.editing .reflection-content-display { display: none; }
.reflection-card.editing .reflection-textarea { display: block; }
.reflection-card.editing .save-reflection-button { display: inline-block; }

.reflection-card.expanded .reflection-content-display { max-height: none; } /* Remove max-height */
.reflection-card.expanded .reflection-content-display::after { display: none; } /* Hide fade */

/* Scripture Links within Reflection */
.scripture-link {
    background: none;
    border: none;
    border-bottom: 1px dashed var(--link-color);
    color: var(--link-color);
    padding: 0 1px;
    margin: 0;
    font-family: inherit;
    font-size: inherit;
    cursor: pointer;
    transition: all var(--transition-fast);
}
.scripture-link:hover, .scripture-link:focus {
    border-bottom-style: solid;
    color: var(--link-hover-color);
    background-color: rgba(212, 175, 55, 0.1); /* Subtle gold background */
}
body.dark-mode .scripture-link {
    border-bottom-color: var(--link-color);
    color: var(--link-color);
}
body.dark-mode .scripture-link:hover, body.dark-mode .scripture-link:focus {
    color: var(--link-hover-color);
    background-color: rgba(212, 175, 55, 0.15);
}

/* --- Settings View --- */
#settingsView {
    max-width: 750px;
    margin: 0 auto;
    /* Ensure this uses the main-app-content background */
     background: var(--bg-main);
}
#settingsView h2 { margin-bottom: var(--space-lg); text-align: center; font-weight: 500; }
.settings-section { margin-bottom: var(--space-xl); padding: var(--space-lg); background: var(--bg-card); border-radius: 8px; border: 1px solid var(--border-main); }
.settings-heading { font-size: 1.4rem; font-weight: 500; margin-bottom: var(--space-lg); border-bottom: 1px solid var(--border-main); padding-bottom: var(--space-sm); color: var(--text-main); }
.setting-item { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: var(--space-md); margin-bottom: var(--space-md); padding-bottom: var(--space-md); border-bottom: 1px dashed var(--border-light); }
.setting-item:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
.setting-item > div:first-child { flex-basis: 60%; flex-grow: 1; }
.setting-label { display: block; margin-bottom: var(--space-xs); font-weight: 500; color: var(--text-main); }
.setting-description { font-size: 0.9rem; color: var(--text-muted); line-height: 1.4; }
.setting-control { flex-shrink: 0; margin-left: auto; min-width: 120px; text-align: right; }
.setting-control.range-control { display: flex; align-items: center; gap: var(--space-sm); min-width: 200px; }
.setting-control input[type="range"] { flex-grow: 1; cursor: pointer; margin: 0; }
.setting-control #fontSizeValue { min-width: 3.5em; text-align: right; font-size: 0.9rem; color: var(--text-muted); }
.setting-control select { padding: var(--space-xs) var(--space-sm); border: 1px solid var(--border-main); border-radius: 4px; background: var(--bg-main); color: var(--text-main); min-width: 120px; font-family: inherit; font-size: 0.95rem; }
.toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; vertical-align: middle; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
.toggle-slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
input:checked + .toggle-slider { background-color: var(--border-accent); }
input:focus + .toggle-slider { box-shadow: 0 0 1px var(--border-accent); }
input:checked + .toggle-slider:before { transform: translateX(24px); }
body.dark-mode .toggle-slider { background-color: #555; }
body.dark-mode input:checked + .toggle-slider { background-color: var(--border-accent); }
.settings-section button.button-secondary, .settings-section button.link-button { display: inline-block; padding: var(--space-xs) var(--space-md); font-size: 0.95rem; font-weight: 500; border: 1px solid var(--border-main); border-radius: 4px; background: var(--bg-button); color: var(--text-button); cursor: pointer; transition: all var(--transition-fast); text-align: center; text-decoration: none; }
.settings-section button.button-secondary:hover, .settings-section button.button-secondary:focus, .settings-section button.link-button:hover, .settings-section button.link-button:focus { border-color: var(--border-accent); background: var(--bg-button-hover); color: var(--link-color); }
body.dark-mode .settings-section button.button-secondary:hover, body.dark-mode .settings-section button.button-secondary:focus, body.dark-mode .settings-section button.link-button:hover, body.dark-mode .settings-section button.link-button:focus { border-color: var(--border-accent); background: var(--bg-button-hover); color: var(--link-hover-color); }

/* --- Styles for Data Management Toggle Section --- */
.settings-item-trigger {
    cursor: pointer;
    /* Ensure consistent spacing, maybe slightly adjust padding */
    padding: var(--space-md); /* Match standard setting item padding */
    margin-bottom: 0; /* Remove bottom margin for this item */
    border-bottom: none; /* No dashed border on the trigger */
    transition: background-color var(--transition-fast);
    /* Add border-radius to match the section */
    border-radius: 8px 8px 0 0; /* Top corners rounded */
}

.settings-item-trigger:hover,
.settings-item-trigger:focus {
    background-color: var(--bg-subtle); /* Highlight on hover/focus */
}
body.dark-mode .settings-item-trigger:hover,
body.dark-mode .settings-item-trigger:focus {
    background-color: #303030; /* Darker subtle bg for dark mode */
}

/* Style for the dropdown icon */
.settings-item-trigger .trigger-icon {
    font-size: 1em; /* Standard size */
    transition: transform var(--transition-fast) ease-out; /* Smooth rotation */
    display: inline-block; /* Allows transform */
}

/* Rotate icon when section is expanded */
.settings-item-trigger[aria-expanded="true"] .trigger-icon {
    transform: rotate(180deg);
}

/* Container that holds the actual data management buttons */
/* Initially hidden by adding the 'hidden' class */
#dataManagementOptions {
     /* Hidden class will set display: none initially */
     /* Add padding to match the section */
     padding: 0 var(--space-md) var(--space-md); /* Pad left/right/bottom */
     overflow: hidden; /* Hide overflow during transition */
     max-height: 0; /* Start collapsed */
     transition: max-height var(--transition-med) ease-out, padding-top var(--transition-med) ease-out;
     border-top: 1px solid var(--border-light); /* Separator line */
     border-radius: 0 0 8px 8px; /* Bottom corners rounded */
     background-color: var(--bg-card); /* Match section background */
     /* Individual setting items inside will handle their own borders */
}
body.dark-mode #dataManagementOptions {
    border-top-color: var(--border-main); /* Dark mode border */
    background-color: var(--bg-card);
}

/* Styles for when the options container is visible (JavaScript will remove 'hidden') */
#dataManagementOptions:not(.hidden) {
     max-height: 300px; /* Set a max-height sufficient for the content */
     padding-top: var(--space-md); /* Add top padding when visible */
     overflow-y: auto; /* Allow vertical scrolling if content exceeds max-height */
     scrollbar-width: thin; /* For Firefox */
     scrollbar-color: var(--border-accent) rgba(0,0,0,0.05); /* For Firefox */
}
#dataManagementOptions:not(.hidden)::-webkit-scrollbar {
    width: 8px;
}
#dataManagementOptions:not(.hidden)::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.05);
    border-radius: 4px;
}
#dataManagementOptions:not(.hidden)::-webkit-scrollbar-thumb {
    background-color: var(--border-accent);
    border-radius: 4px;
    border: 1px solid var(--bg-subtle); /* Match reading view scrollbar thumb border */
}
/* Adjust max-height for small screens if necessary later */


/* Ensure setting items inside the options container look correct */
#dataManagementOptions .setting-item {
     /* Inherits base setting-item styles */
     /* The border-bottom needs to apply correctly */
     border-bottom: 1px dashed var(--border-light);
     padding: var(--space-md) 0; /* Adjust vertical padding */
     margin-bottom: 0; /* Remove margin between items inside */
}
#dataManagementOptions .setting-item:last-child {
     border-bottom: none; /* Remove border on the last item */
     padding-bottom: 0;
}
#dataManagementOptions .setting-item .setting-label {
    margin-bottom: 0; /* Remove label margin if no description */
}

/* Style for the Import button label */
#importUserDataButton {
    /* Inherits button-secondary styles */
    /* Ensure it looks like other buttons */
    display: inline-block; /* Important for label */
    text-align: center;
}


/* --- Reading View --- */
.reading-view { display: none; flex-direction: column; position: fixed; top: 0; left: 0; height: 100vh; width: 100vw; z-index: 100; overflow: hidden; background-color: var(--bg-nav); }
.reading-view[aria-hidden="false"] { display: flex; }
.reading-container { display: flex; flex-direction: column; height: 100%; width: 100%; position: relative; }
.reading-header, .chapter-nav-container, .reading-footer { flex-shrink: 0; transition: opacity var(--transition-med), transform var(--transition-med), height var(--transition-med), padding var(--transition-med), border var(--transition-med); background: var(--bg-nav); z-index: 110; }
.reading-header { padding: var(--space-sm) var(--space-md); background: var(--bg-header-grad); color: var(--text-on-grad); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px var(--shadow-color); }
.reading-header h2 { font-weight: 500; font-size: clamp(1.1rem, 4vw, 1.4rem); margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-grow: 1; margin-right: var(--space-sm); text-align: left; }
#crossRefBackButtonContainer { position: absolute; top: 5px; left: 45px; z-index: 1; margin-right: auto; padding-left: var(--space-md); flex-shrink: 1; overflow: hidden; text-align: left; }
#crossRefBackButton { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2); color: white; padding: var(--space-xs) var(--space-sm); border-radius: 6px; cursor: pointer; transition: all var(--transition-fast); font-size: 0.85rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; display: inline-block; }
#crossRefBackButton:hover, #crossRefBackButton:focus { background: rgba(255,255,255,0.3); border-color: rgba(255,255,255,0.4); }
.reading-controls { display: flex; gap: var(--space-sm); flex-wrap: nowrap; flex-shrink: 0; }
.reading-controls button {
    background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2); color: white;
    /* MODIFIED: Increased padding and font-size for better tap target and visibility */
    padding: var(--space-sm) var(--space-sm); /* Square-ish padding */
    border-radius: 6px; cursor: pointer; transition: all var(--transition-fast);
    display: flex; align-items: center; gap: var(--space-xs);
    /* MODIFIED: Increased font size for base button text/icon scaling */
    font-size: 1rem; /* Base font size (affects icon size via em units) */
    white-space: nowrap; font-family: var(--font-ui);
    /* MODIFIED: Adjusted line height for vertical alignment */
    line-height: 1.2; /* Slightly more line height for text below icon */
}

body.dark-mode .reading-controls button { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.15); }
.reading-controls button:hover, .reading-controls button:focus { background: rgba(255,255,255,0.3); border-color: rgba(255,255,255,0.4); }
body.dark-mode .reading-controls button:hover, body.dark-mode .reading-controls button:focus { background: rgba(255, 255, 255, 0.2); border-color: rgba(255, 255, 255, 0.3); }
.reading-controls button .icon {
    /* MODIFIED: Increased icon size and margin-bottom */
    font-size: 1.4em; /* Icon size relative to button's font-size */
    margin-bottom: 4px; /* Space below the icon */
    line-height: 1; /* Ensure icon is vertically centered */
}
.chapter-nav-container { padding: var(--space-sm) var(--space-md) 0; border-bottom: 1px solid var(--border-main); overflow-x: auto; overflow-y: hidden; box-shadow: 0 2px 5px var(--shadow-color); scrollbar-width: thin; scrollbar-color: var(--progress-bar-color) transparent; position: relative; }
.chapter-nav-container::-webkit-scrollbar { height: 5px; }
.chapter-nav-container::-webkit-scrollbar-track { background: transparent; }
.chapter-nav-container::-webkit-scrollbar-thumb { background-color: var(--progress-bar-color); border-radius: 10px; border: 1px solid var(--bg-nav); }
.reading-progress-bar-container { position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background-color: transparent; overflow: hidden; pointer-events: none; z-index: 115; }
.reading-progress-bar { width: 0%; height: 100%; background-color: var(--progress-bar-color); transition: width 0.15s linear; }
.chapter-nav { display: flex; gap: var(--space-sm); padding-bottom: calc(var(--space-sm) + 3px); }
.chapter-nav .loading-placeholder, .chapter-nav .chapter-nav-info { padding: var(--space-xs) var(--space-md); color: var(--text-muted); font-style: italic; white-space: nowrap; }
.chapter-nav-btn { background: var(--bg-card); border: 1px solid var(--border-main); padding: var(--space-xs) var(--space-md); border-radius: 50px; cursor: pointer; transition: all var(--transition-fast); font-family: var(--font-ui); font-size: 0.85rem; white-space: nowrap; color: var(--text-main); flex-shrink: 0; min-width: 40px; text-align: center; }
body.dark-mode .chapter-nav-btn { background: var(--bg-card); color: var(--text-main); border-color: var(--border-main); }
.chapter-nav-btn:hover:not(.active), .chapter-nav-btn:focus:not(.active) { background: var(--bg-main); border-color: var(--border-accent); color: var(--border-accent); }
body.dark-mode .chapter-nav-btn:hover:not(.active), body.dark-mode .chapter-nav-btn:focus:not(.active) { background: #333; }
.chapter-nav-btn.active { background: var(--border-accent); color: var(--text-on-accent); border-color: var(--border-accent); font-weight: 600; box-shadow: 0 1px 4px rgba(0,0,0,0.15); cursor: default; }
body.dark-mode .chapter-nav-btn.active { color: var(--scripture-black); }
.reading-content { flex: 1; padding: var(--space-lg) var(--space-md); overflow-y: auto; font-family: var(--font-reading); font-size: 1.1em; line-height: 1.7; background: var(--bg-reading); -webkit-overflow-scrolling: touch; position: relative; outline: none; }
.reading-content p { margin-bottom: 0.8em; }
.reading-content p:last-child { margin-bottom: 0; }
.verse-number { font-weight: bold; color: var(--text-muted); margin-right: 0.4em; font-size: 0.8em; vertical-align: super; user-select: none; -webkit-user-select: none; display: inline-block; }
body.dark-mode .verse-number { color: var(--text-muted); }
.non-verse-line { font-style: italic; color: var(--text-muted); margin-left: 1.5em; }
.highlight-target { background-color: var(--highlight-bg); transition: background-color 1.5s ease-out 1s; border-radius: 3px; padding: 0.1em 0.3em; margin: -0.1em -0.3em; box-decoration-break: clone; -webkit-box-decoration-break: clone; }
.reading-footer { padding: var(--space-sm) var(--space-md); border-top: 1px solid var(--border-main); box-shadow: 0 -2px 5px var(--shadow-color); text-align: center; }
.reading-footer nav { display: flex; justify-content: space-between; max-width: 400px; margin: 0 auto; }
.nav-btn { padding: var(--space-sm) var(--space-lg); font-family: var(--font-ui); font-size: 0.9rem; font-weight: 500; border: 1px solid var(--border-main); border-radius: 6px; background: var(--bg-card); color: var(--link-color); cursor: pointer; transition: all var(--transition-fast); white-space: nowrap; }
body.dark-mode .nav-btn { background: var(--bg-card); border-color: var(--border-main); color: var(--link-color); }
.nav-btn:hover:not(:disabled), .nav-btn:focus:not(:disabled) { background: var(--bg-main); border-color: var(--border-accent); color: var(--border-accent); }
body.dark-mode .nav-btn:hover:not(:disabled), body.dark-mode .nav-btn:focus:not(:disabled) { background: #333; }
.nav-btn:disabled { opacity: 0.5; cursor: not-allowed; background: var(--bg-main); border-color: var(--border-light); color: var(--text-muted); }
body.dark-mode .nav-btn:disabled { background: #333; border-color: var(--border-main); color: var(--text-muted); }
.reading-view.ui-hidden .reading-header, .reading-view.ui-hidden .chapter-nav-container, .reading-view.ui-hidden .reading-footer { opacity: 0; pointer-events: none; overflow: hidden; }
.reading-view.ui-hidden .reading-header { transform: translateY(-100%); height: 0; padding-top: 0; padding-bottom: 0; border-bottom: none; }
.reading-view.ui-hidden .reading-footer { transform: translateY(100%); height: 0; padding-top: 0; padding-bottom: 0; border-top: none; }
.reading-view.ui-hidden .chapter-nav-container { transform: translateY(-50%) scaleY(0); height: 3px; padding: 0; border: none; box-shadow: none; overflow: visible; }
.reading-view.ui-hidden .chapter-nav { display: none; }
.reading-view.ui-hidden .reading-progress-bar-container { bottom: 0; opacity: 1; transition: none; }

/* --- Custom Context Menu --- */
#custom-context-menu { display: none; position: absolute; background-color: var(--bg-card); border: 1px solid var(--border-main); box-shadow: 2px 4px 10px var(--shadow-color); border-radius: 6px; padding: var(--space-sm) 0; z-index: 200; min-width: 150px; }
#custom-context-menu[aria-hidden="false"] { display: block; }
#custom-context-menu [role="menuitem"] { display: block; width: 100%; text-align: left; padding: var(--space-sm) var(--space-md); border: none; background: none; cursor: pointer; color: var(--text-main); font-size: 0.95rem; white-space: nowrap; }
#custom-context-menu [role="menuitem"]:hover, #custom-context-menu [role="menuitem"]:focus { background-color: var(--bg-main); color: var(--link-color); }
body.dark-mode #custom-context-menu [role="menuitem"]:hover, body.dark-mode .custom-context-menu [role="menuitem"]:focus { background-color: #333; color: var(--link-hover-color); }


/* --- User Highlights (Multi-Color Support) --- */
.user-highlight { cursor: pointer; border-radius: 2px; padding: 0 1px; box-decoration-break: clone; -webkit-box-decoration-break: clone; outline: none; }
.user-highlight:focus, .user-highlight:hover { box-shadow: 0 0 0 2px currentColor; /* Use current highlight color for focus */ }
/* Define background and focus background per color */
.hl-color-yellow { background-color: var(--user-highlight-yellow); color: var(--user-highlight-yellow); } /* Using color prop just to carry the color value for focus */
.hl-color-pink { background-color: var(--user-highlight-pink); color: var(--user-highlight-pink); }
.hl-color-lightblue { background-color: var(--user-highlight-lightblue); color: var(--user-highlight-lightblue); }
.hl-color-lightgreen { background-color: var(--user-highlight-lightgreen); color: var(--user-highlight-lightgreen); }
.hl-color-orange { background-color: var(--user-highlight-orange); color: var(--user-highlight-orange); }
.hl-color-yellow:hover, .hl-color-yellow:focus { background-color: var(--user-highlight-focus-yellow); }
.hl-color-pink:hover, .hl-color-pink:focus { background-color: var(--user-highlight-focus-pink); }
.hl-color-lightblue:hover, .hl-color-lightblue:focus { background-color: var(--user-highlight-focus-lightblue); }
.hl-color-lightgreen:hover, .hl-color-lightgreen:focus { background-color: var(--user-highlight-focus-lightgreen); }
.hl-color-orange:hover, .hl-color-orange:focus { background-color: var(--user-highlight-focus-orange); }


/* Highlight Color Picker */
#highlight-color-picker { display: none; position: absolute; z-index: 1001; background: var(--bg-card); border: 1px solid var(--border-main); padding: var(--space-sm); border-radius: 6px; box-shadow: 2px 2px 8px var(--shadow-color); }
#highlight-color-picker p { margin: 0 0 var(--space-sm) 0; font-size: 0.9em; font-weight: 500; text-align: center; color: var(--text-muted); }
.color-swatches { display: flex; gap: var(--space-sm); justify-content: center; }
.color-swatch { width: 28px; height: 28px; border: 2px solid transparent; border-radius: 50%; cursor: pointer; transition: all var(--transition-fast); box-shadow: 0 1px 3px var(--shadow-color); }
.color-swatch:hover, .color-swatch:focus { transform: scale(1.1); border-color: var(--border-accent); }
.color-swatch.active-color { border-color: var(--scripture-black); box-shadow: 0 0 0 2px white, 0 0 0 4px var(--scripture-black); /* Enhanced focus/active state */ }
body.dark-mode .color-swatch.active-color { border-color: white; box-shadow: 0 0 0 2px var(--bg-main), 0 0 0 4px white; }


/* --- Cross References --- */
.cross-ref-trigger { display: inline-block; position: relative; width: 1.5em; height: 1.5em; line-height: 1.5em; text-align: center; font-size: 0.8em; color: transparent; background-image: linear-gradient(to bottom right, var(--trigger-bg-start), var(--trigger-bg-end)); border: 1px solid transparent; border-radius: 50%; box-shadow: 0 1px 3px rgba(0,0,0,0.15); cursor: pointer; margin-left: 5px; vertical-align: middle; user-select: none; -webkit-user-select: none; transition: all var(--transition-fast); outline: none; }
.cross-ref-trigger::before { content: ''; position: absolute; top: 50%; left: 50%; width: 4px; height: 4px; background-color: var(--trigger-icon-color); border-radius: 50%; transform: translate(-50%, -50%); transition: background-color var(--transition-fast); }
body.dark-mode .cross-ref-trigger {
    box-shadow: 0 1px 3px rgba(0,0,0,0.4);
    /* MODIFIED: Use new dark mode gradient variables */
    background-image: linear-gradient(to bottom right, var(--trigger-bg-start-dark), var(--trigger-bg-end-dark));
    border-color: transparent; /* Ensure no conflicting border from light mode */
}

body.dark-mode .cross-ref-trigger::before {
    /* MODIFIED: Use new dark mode icon color variable */
    background-color: var(--trigger-icon-color-dark);
}

/* Dark Mode Hover and Focus States for the trigger */
body.dark-mode .cross-ref-trigger:hover,
body.dark-mode .cross-ref-trigger:focus {
    transform: scale(1.1); /* Keep scale effect */
    border-color: var(--trigger-border-color-dark-hover); /* Use new dark mode border hover */
    background-image: linear-gradient(to bottom right, var(--trigger-hover-bg-start-dark), var(--trigger-hover-bg-end-dark)); /* Use new dark mode hover gradient */
    box-shadow: 0 2px 5px var(--shadow-color), 0 0 0 2px var(--trigger-focus-ring-dark); /* Use new dark mode focus ring */
}

body.dark-mode .cross-ref-trigger:hover::before,
body.dark-mode .cross-ref-trigger:focus::before {
    /* MODIFIED: Use new dark mode dot hover color */
    background-color: var(--trigger-dot-color-dark-hover);
}
.temp-no-refs-msg { font-size: 0.8em; font-style: italic; color: var(--text-muted); margin-left: 5px; vertical-align: middle; animation: fadeOut 2s ease-out forwards; }
@keyframes fadeOut { from { opacity: 1; } to { opacity: 0; }}
.cross-ref-expansion { display: block; opacity: 0; max-height: 0; margin-top: 0; margin-bottom: 0; overflow: hidden; transition: max-height var(--transition-med) ease-in-out, opacity var(--transition-med) ease-in-out, margin-top var(--transition-med) ease-in-out, margin-bottom var(--transition-med) ease-in-out, padding-top var(--transition-med) ease-in-out, padding-bottom var(--transition-med) ease-in-out; border: 1px solid var(--border-main); border-top: 3px solid var(--border-accent); background-color: var(--bg-subtle); padding: 0 var(--space-md); margin-left: 1.5em; border-radius: 8px; font-size: 0.95em; box-shadow: 0 4px 12px var(--shadow-color); max-width: calc(100% - 1.5em); position: relative; }
.cross-ref-expansion.visible { opacity: 1; max-height: 350px; margin-top: var(--space-sm); margin-bottom: var(--space-md); padding: var(--space-md); overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--border-accent) rgba(0,0,0,0.05); }
.cross-ref-expansion.visible::-webkit-scrollbar { width: 8px; }
.cross-ref-expansion.visible::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 4px; }
.cross-ref-expansion.visible::-webkit-scrollbar-thumb { background-color: var(--border-accent); border-radius: 4px; border: 1px solid var(--bg-subtle); }
body.dark-mode .cross-ref-expansion { border-color: var(--border-light); border-top-color: var(--border-accent); background-color: var(--bg-card); box-shadow: 0 4px 15px var(--shadow-color); scrollbar-color: var(--border-accent) rgba(255,255,255,0.05); }
body.dark-mode .cross-ref-expansion.visible::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
body.dark-mode .cross-ref-expansion.visible::-webkit-scrollbar-thumb { border-color: var(--bg-card); }
.close-expansion-button { position: absolute; top: calc(var(--space-sm) - 2px); right: calc(var(--space-sm) - 2px); background: none; border: none; width: 28px; height: 28px; line-height: 28px; text-align: center; font-size: 1.6rem; font-weight: 300; padding: 0; color: var(--text-muted); cursor: pointer; transition: all var(--transition-fast); z-index: 1; border-radius: 50%; }
.close-expansion-button:hover, .close-expansion-button:focus { color: var(--text-danger); background-color: rgba(0,0,0,0.05); transform: scale(1.1); }
body.dark-mode .close-expansion-button:hover, body.dark-mode .close-expansion-button:focus { background-color: rgba(255,255,255,0.1); }
.cross-ref-expansion ul { list-style: none; padding: 0; margin: 0; margin-top: var(--space-lg); }
.cross-ref-expansion li { display: flex; align-items: flex-start; gap: var(--space-sm); margin-bottom: var(--space-md); padding-bottom: var(--space-md); border-bottom: 1px solid var(--border-light); }
body.dark-mode .cross-ref-expansion li { border-bottom-color: var(--border-main); }
.cross-ref-expansion li:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
.ref-details { flex-grow: 1; min-width: 0; }
.cross-ref-target { font-weight: 600; color: var(--link-color); display: block; margin-bottom: var(--space-xs); font-size: 1.05em; }
body.dark-mode .cross-ref-target { color: var(--link-color); }
.cross-ref-type { font-size: 0.8em; color: var(--text-muted); margin-left: var(--space-xs); font-style: italic; }
.cross-ref-text { display: block; margin-top: var(--space-sm); padding-left: var(--space-md); border-left: 4px solid var(--border-accent); color: var(--text-main); font-style: normal; line-height: 1.5; font-family: var(--font-reading); }
body.dark-mode .cross-ref-text { border-left-color: var(--border-accent); }
.go-to-ref-button { flex-shrink: 0; padding: var(--space-xs) var(--space-sm); font-size: 0.85em; font-weight: 500; border: 1px solid var(--border-main); border-radius: 4px; background: var(--bg-button); color: var(--text-button); cursor: pointer; transition: all var(--transition-fast); white-space: nowrap; align-self: center; }
body.dark-mode .go-to-ref-button { background: var(--bg-button); border-color: var(--border-main); color: var(--text-button); }
.go-to-ref-button:hover, .go-to-ref-button:focus { background: var(--border-accent); border-color: var(--border-accent); color: var(--text-on-accent); box-shadow: 0 1px 4px var(--shadow-color); transform: translateY(-1px); }
body.dark-mode .go-to-ref-button:hover, body.dark-mode .go-to-ref-button:focus { background: var(--border-accent); border-color: var(--border-accent); color: var(--scripture-black); }


/* --- Responsive Design --- */
@media (max-width: 767px) {
    .view-tabs-container { display: none; }
    .bottom-nav { display: flex; }
    .main-app-content { padding-bottom: 70px; padding-left: var(--space-sm); padding-right: var(--space-sm); } /* Adjust padding */
    .settings-item { flex-direction: column; align-items: stretch; gap: var(--space-sm); }
    .settings-item > div:first-child { flex-basis: auto; }
    .setting-control { margin-left: 0; min-width: 0; text-align: left; width: 100%; }
    .setting-control select, .setting-control.range-control { width: 100%; min-width: 0; }
    .setting-control #fontSizeValue { min-width: auto; text-align: left; margin-left: var(--space-sm); }
    .settings-section button.link-button, .settings-section button.button-secondary { text-align: left; width: auto; display: inline-block; }
    .reading-header h2 { font-size: 1.1rem; }
    #crossRefBackButtonContainer { padding-left: var(--space-sm); }
    #crossRefBackButton { max-width: 120px; font-size: 0.8rem; }
  .reading-controls button {
        padding: var(--space-xs); /* Slightly smaller padding on mobile */
        font-size: 0.9rem; /* Slightly smaller base font on mobile than desktop */
        line-height: 1.2; /* Keep same line height */
    }
     /* ADDED: Specific icon sizing for mobile */
     .reading-controls button .icon {
         font-size: 1.3em; /* Icon size relative to mobile button font-size (0.9rem * 1.3 = 1.17rem) */
         margin-bottom: 2px; /* Smaller space below icon on mobile */
     }
.reading-controls button .visually-hidden { display: none; }
    .nav-btn { padding: var(--space-sm) var(--space-md); }
    .cross-ref-expansion { margin-left: 0.5em; max-width: calc(100% - 0.5em); font-size: 0.9em; }
    .cross-ref-expansion li { flex-direction: column; align-items: stretch; gap: var(--space-xs); }
    .go-to-ref-button { margin-top: var(--space-sm); align-self: flex-end; width: auto; }
    .close-expansion-button { font-size: 1.4rem; width: 24px; height: 24px; line-height: 24px; top: var(--space-xs); right: var(--space-xs); }
    /* Reflection cards on mobile */
    .reflection-card-header { padding: var(--space-xs) var(--space-sm); /* Less padding */ }
    .reflection-date { font-size: 0.8em; }
    .reflection-card-controls button { width: 24px; height: 24px; line-height: 24px; font-size: 1.2rem; padding: 0; } /* Make delete button smaller */
    .save-reflection-button { font-size: 0.8em; padding: var(--space-xs); }
    .reflection-content-display { padding: var(--space-sm); }
    .reflection-textarea { padding: var(--space-sm); font-size: 0.95em; }

    /* Data Management section on mobile */
    .settings-item-trigger { padding: var(--space-sm); /* Smaller padding on mobile trigger */ }
    #dataManagementOptions:not(.hidden) {
         padding-left: var(--space-sm); /* Adjust padding inside options */
         padding-right: var(--space-sm);
         padding-top: var(--space-sm); /* Less padding on mobile */
         padding-bottom: var(--space-sm);
         max-height: 400px; /* Adjust max-height if needed for mobile */
    }
     #dataManagementOptions .setting-item {
          padding: var(--space-sm) 0; /* Adjust vertical padding */
     }
     #dataManagementOptions .setting-item:last-child {
          padding-bottom: 0;
     }
}



/* --- NEW: Audio Player Modal Styles --- */

/* Modal Overlay (for background and centering) */
/* Enhanced: Ensure transition smoothness */
.modal-overlay {
    position: fixed; /* Fixed position to cover the viewport */
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent dark background */
    display: flex; /* Use flexbox to center content */
    justify-content: center; /* Center horizontally */
    align-items: center; /* Center vertically */
    z-index: 1000; /* Ensure it's above other app content */

    /* Add transition for fade effect */
    opacity: 1;
    transition: opacity var(--transition-fast, 0.2s) ease-in-out; /* Added fallback duration */

     /* Allow clicks to pass through when hidden */
    pointer-events: auto; /* Enable pointer events when visible */
}

/* Rule to hide the modal - using the 'hidden' class you already have */
/* Enhanced: Only control opacity and pointer-events for hiding animation */
.modal-overlay.hidden {
    opacity: 0; /* Fade out */
    pointer-events: none; /* Prevent any interaction when hidden */
    /* Keep display: flex so transitions work on display-related properties if needed,
       but rely primarily on opacity and pointer-events for invisibility/interactivity.
       If display: none is added by JS later, the transition won't happen, but that's OK as a final state. */
    /* display: flex; */ /* <-- Keep display: flex here if your JS only adds/removes the 'hidden' class */
     display: none; /* <-- If your JS *also* sets display: none after transition, use this. */
}

/* Modal Content Container (holds the audio player itself) */
/* Enhanced: Added structure for a header and footer */
.modal-content {
    background: var(--bg-card, #fff); /* Background matching your card style, added fallback */
    padding: var(--space-lg, 20px); /* Use your defined spacing, added fallback */
    border-radius: 8px; /* Match app's standard border-radius */
    box-shadow: 0 5px 15px var(--shadow-color, rgba(0,0,0,0.3)); /* Match app's standard shadow, added fallback */

    /* Ensure content is visible relative to overlay */
    position: relative;
    z-index: 1; /* Above the overlay background */
    max-width: 95vw; /* Ensure it doesn't overflow small screens horizontally */
    max-height: 95vh; /* Ensure it doesn't overflow small screens vertically */
    overflow-y: auto; /* Add scroll if content is too tall */


    /* Add animation for scale-in effect when appearing */
    /* This rule applies only when the modal-overlay is NOT hidden */
}
.modal-overlay:not(.hidden) .modal-content {
    animation: scaleIn 0.2s ease-out forwards;
}
/* Keyframes for the scale-in animation */
@keyframes scaleIn {
    from { transform: scale(0.9); opacity: 0.8; }
    to { transform: scale(1); opacity: 1; }
}


/* Audio Player Container (adapting your .audio-player styles) */
/* Enhanced: Added relative positioning for internal absolute elements like close button */
.audio-player {
    background: var(--bg-subtle, #f8f8f8); /* Use a subtle background for the player interface, added fallback */
    padding: var(--space-md, 15px); /* Use your defined spacing, added fallback */
    border-radius: 8px; /* Match modal content radius */
    box-shadow: none; /* No shadow here, modal-content has it */
    width: min(90vw, 360px); /* Made it slightly wider, max 360px or 90% */
    color: var(--text-main, #333); /* Use main text color, added fallback */
    position: relative; /* Added for positioning children absolutely (like close button) */
}
body.dark-mode .audio-player {
     background: var(--bg-subtle-dark, #333); /* Dark mode subtle background */
     color: var(--text-main-dark, #eee); /* Dark mode main text color */
}


/* Optional: Audio Player Header for chapter reference */
/* You might need to add an element like <div id="audioModalHeaderRef"></div> inside your modal HTML */
.audio-player .audio-player-header {
     font-size: 1.1em; /* Slightly larger text */
     font-weight: bold;
     text-align: center;
     margin-bottom: var(--space-md, 15px);
     color: var(--text-main, #333); /* Main text color */
}
body.dark-mode .audio-player .audio-player-header {
     color: var(--text-main-dark, #eee);
}

/* Audio Element (kept hidden as you intend to use custom controls) */
.audio-player audio {
    display: none;
}

/* Controls section (adapting your .controls styles) */
.audio-player .controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: var(--space-md, 15px); /* Adjust margin using variables, added fallback */
    gap: var(--space-sm, 10px); /* Add gap between buttons, added fallback */
}

/* Buttons within controls (adapting your button styles) */
/* Enhanced: Made buttons slightly larger and more distinct */
.audio-player .controls button {
    background: var(--bg-button, #eee); /* Use standard button background, added fallback */
    border: 1px solid var(--border-main, #ccc); /* Match app buttons border, added fallback */
    /* Adjust padding and font size to make buttons roughly square and icons clear */
    padding: var(--space-sm, 10px) var(--space-sm, 10px); /* Square-ish padding */
    border-radius: 6px; /* Match app buttons border-radius */
    color: var(--text-button, #333); /* Use standard button text color, added fallback */
    cursor: pointer;
    font-size: 1.2rem; /* Increased font size for icons */
    transition: all var(--transition-fast, 0.2s); /* Use app's transition variable, added fallback */
    text-align: center; /* Ensure text is centered */
     flex: 1; /* Make buttons grow equally to fill space */
     min-width: 0; /* Allow buttons to shrink if needed */
     display: flex; /* Use flexbox to center icon */
     justify-content: center;
     align-items: center;
     line-height: 1; /* Ensure icon isn't cut off */
}
body.dark-mode .audio-player .controls button {
     background: var(--bg-button-dark, #555);
     border-color: var(--border-main-dark, #777);
     color: var(--text-button-dark, #eee);
}


.audio-player .controls button:hover:not(:disabled),
.audio-player .controls button:focus:not(:disabled) {
    background: var(--bg-button-hover, #ddd); /* Hover background */
    border-color: var(--border-accent, #007bff); /* Accent border on hover/focus */
    color: var(--link-color, #007bff); /* Link color on hover/focus */
     box-shadow: 0 1px 4px rgba(0,0,0,0.1); /* Subtle hover shadow */
}
body.dark-mode .audio-player .controls button:hover:not(:disabled),
body.dark-mode .audio-player .controls button:focus:not(:disabled) {
     background: var(--bg-button-hover-dark, #666);
     border-color: var(--border-accent-dark, #4a90e2);
     color: var(--link-hover-color-dark, #6cb5f3);
     box-shadow: 0 1px 4px rgba(0,0,0,0.4);
}

/* Highlight the main Play/Pause button */
.audio-player .controls #playPauseBtn:not(:disabled) {
     background-color: var(--border-accent, #007bff); /* Accent background */
     color: var(--bg-card, #fff); /* Light color on accent */
     border-color: var(--border-accent, #007bff);
     font-size: 1.5rem; /* Make play/pause icon larger */
     padding: var(--space-sm, 10px); /* Keep padding consistent */
}
body.dark-mode .audio-player .controls #playPauseBtn:not(:disabled) {
     background-color: var(--border-accent-dark, #4a90e2);
     color: var(--bg-card-dark, #222);
     border-color: var(--border-accent-dark, #4a90e2);
}

.audio-player .controls #playPauseBtn:hover:not(:disabled),
.audio-player .controls #playPauseBtn:focus:not(:disabled) {
    background-color: var(--border-accent-hover, #0056b3); /* Darker accent on hover */
    border-color: var(--border-accent-hover, #0056b3);
    color: var(--bg-card, #fff); /* Keep light color */
}
body.dark-mode .audio-player .controls #playPauseBtn:hover:not(:disabled),
body.dark-mode .audio-player .controls #playPauseBtn:focus:not(:disabled) {
     background-color: var(--border-accent-hover-dark, #3a7acc);
     border-color: var(--border-accent-hover-dark, #3a7acc);
     color: var(--bg-card-dark, #222);
}


.audio-player .controls button:disabled {
     opacity: 0.5; /* Dim disabled buttons */
     cursor: not-allowed;
     background: var(--bg-button-disabled, #f0f0f0); /* Use a specific disabled background */
     border-color: var(--border-main, #ccc); /* Keep base border */
     color: var(--text-muted, #999); /* Muted text for disabled */
     box-shadow: none; /* No shadow when disabled */
}
body.dark-mode .audio-player .controls button:disabled {
     background: var(--bg-button-disabled-dark, #444);
     border-color: var(--border-main-dark, #777);
     color: var(--text-muted-dark, #888);
}


/* Progress Container (adapting your .progress-container styles) */
/* Enhanced: No major changes, already good */
.audio-player .progress-container {
    margin: var(--space-md, 15px) 0 var(--space-sm, 10px) 0; /* Adjust spacing using variables, space below for time */
    width: 100%; /* Ensure it takes full width */
}

/* Range Input (Progress Bar) - adapting your input[type="range"] styles */
/* Enhanced: Slightly thicker track, clearer thumb, better focus */
.audio-player input[type="range"] {
    width: 100%;
    appearance: none; /* Remove default browser appearance */
    background: var(--border-light, #ddd); /* Track background color, added fallback */
    height: 8px; /* Slightly thicker track */
    border-radius: 4px; /* Rounded corners for track */
    outline: none;
    cursor: pointer;
     margin: 0; /* Remove default margin */
     transition: opacity var(--transition-fast, 0.2s); /* Add transition for hover */
}
body.dark-mode .audio-player input[type="range"] {
     background: var(--border-light-dark, #555); /* Dark mode track color */
}

.audio-player input[type="range"]:hover {
     opacity: 0.9; /* Slightly less than 1 to allow background elements to show subtle focus ring */
}
.audio-player input[type="range"]:disabled {
     opacity: 0.5;
     cursor: default;
}


/* Range Input Thumb (Progress Bar Thumb) - adapting your ::-webkit-slider-thumb styles */
/* Enhanced: Slightly larger thumb, different color options */
.audio-player input[type="range"]::-webkit-slider-thumb {
    appearance: none; /* Remove default appearance */
    height: 16px; /* Thumb size */
    width: 16px; /* Thumb size */
    border-radius: 50%; /* Make it round */
    background: var(--link-color, #007bff); /* Thumb color using link variable */
    border: 3px solid var(--bg-card, #fff); /* Border for contrast with track background and modal background */
    margin-top: -4px; /* Vertically center thumb on track (adjust for track height and border) */
    cursor: pointer;
     box-shadow: 0 2px 5px var(--shadow-color, rgba(0,0,0,0.3)); /* Clearer shadow */
     transition: background var(--transition-fast, 0.2s), border-color var(--transition-fast, 0.2s), box-shadow var(--transition-fast, 0.2s); /* Add transition */
}
body.dark-mode .audio-player input[type="range"]::-webkit-slider-thumb {
    background: var(--link-color-dark, #6cb5f3);
    border-color: var(--bg-card-dark, #222); /* Match dark mode card background */
}

/* Firefox thumb styles */
.audio-player input[type="range"]::-moz-range-thumb {
    height: 16px;
    width: 16px;
    border-radius: 50%;
    background: var(--link-color, #007bff);
    border: 3px solid var(--bg-card, #fff);
    margin-top: -4px;
    cursor: pointer;
    box-shadow: 0 2px 5px var(--shadow-color, rgba(0,0,0,0.3));
    transition: background var(--transition-fast, 0.2s), border-color var(--transition-fast, 0.2s), box-shadow var(--transition-fast, 0.2s);
}
body.dark-mode .audio-player input[type="range"]::-moz-range-thumb {
    background: var(--link-color-dark, #6cb5f3);
    border-color: var(--bg-card-dark, #222);
}

/* Add focus styles for accessibility */
.audio-player input[type="range"]:focus-visible {
    outline: 2px solid var(--border-focus, #0056b3); /* Use focus color */
    outline-offset: 3px; /* Space between thumb/track and outline */
    border-radius: 50%; /* Ensure focus ring is round for the thumb */
}
body.dark-mode .audio-player input[type="range"]:focus-visible {
    outline-color: var(--border-focus-dark, #3a7acc);
}


/* Time Display (adapting your .time styles) */
/* Enhanced: Slightly larger font, consistent color */
.audio-player .time {
    font-size: 0.9rem; /* Slightly larger than 0.85 */
    display: flex;
    justify-content: space-between; /* Space out current and duration times */
    color: var(--text-muted, #999); /* Muted text color */
    margin-top: var(--space-xs, 5px); /* Add margin above time display */
}
body.dark-mode .audio-player .time {
    color: var(--text-muted-dark, #888);
}


/* Optional: Close Button for the Modal */
/* You likely need to add an element like <button class="close-button"></button> inside your .audio-player HTML */
.audio-player .close-button {
     position: absolute; /* Position relative to .audio-player */
     top: var(--space-sm, 10px);
     right: var(--space-sm, 10px);
     background: transparent; /* Transparent background */
     border: none;
     color: var(--text-muted, #999); /* Muted color initially */
     font-size: 1.5rem; /* Size of the 'x' icon */
     cursor: pointer;
     padding: var(--space-xs, 5px); /* Small padding for click area */
     line-height: 1;
     transition: color var(--transition-fast, 0.2s);
     z-index: 10; /* Ensure it's above other elements in the player */
}
.audio-player .close-button:hover,
.audio-player .close-button:focus {
     color: var(--text-main, #333); /* Darker on hover/focus */
     outline: none; /* Remove default focus outline */
     /* Add a custom focus style if needed, e.g., box-shadow */
}
body.dark-mode .audio-player .close-button {
     color: var(--text-muted-dark, #888);
}
body.dark-mode .audio-player .close-button:hover,
body.dark-mode .audio-player .close-button:focus {
     color: var(--text-main-dark, #eee);
}


/* --- End Audio Player Modal Styles --- */


/* --- Download Manager Modal Styles --- */

/* Inherits .modal-overlay from Audio Player */

.download-modal-content {
    /* Inherits basic .modal-content styles */
    max-width: 600px;
    width: 95%;
    display: flex;
    flex-direction: column;
    max-height: 85vh;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-md);
    border-bottom: 1px solid var(--border-light);
    padding-bottom: var(--space-sm);
}

.modal-title {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-main);
}

.modal-body {
    flex-grow: 1;
    overflow-y: auto;
    padding-right: var(--space-sm);
    margin-bottom: var(--space-md);
}

.modal-description {
    font-size: 0.95rem;
    color: var(--text-muted);
    margin-bottom: var(--space-lg);
}

.download-options-container {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
}

.download-language-group {
    border: 1px solid var(--border-main);
    border-radius: 8px;
    padding: var(--space-md);
    margin: 0;
}

.download-language-group legend {
    padding: 0 var(--space-sm);
    font-weight: 600;
    color: var(--link-color);
    font-family: var(--font-ui);
}

.download-option-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-sm) 0;
    border-bottom: 1px dashed var(--border-light);
    cursor: pointer;
}

.download-language-group .download-option-item:last-child {
    border-bottom: none;
}

.option-details {
    display: flex;
    flex-direction: column;
}

.option-title {
    font-weight: 500;
    color: var(--text-main);
}

.option-status {
    font-size: 0.85em;
    font-style: italic;
    color: var(--text-muted);
    margin-top: 2px;
}

.option-status[data-status="downloaded"] {
    color: var(--sacred-gold);
    font-weight: 500;
}
.option-status[data-status="error"] {
    color: var(--text-danger);
}

/* Re-using toggle-switch styles from Settings, ensured they work here */
.download-option-item .toggle-switch {
    flex-shrink: 0;
    margin-left: var(--space-md);
}

.download-progress-container {
    margin-top: var(--space-md);
    padding: var(--space-md);
    background-color: var(--bg-subtle);
    border-radius: 6px;
    border: 1px solid var(--border-main);
}

#downloadModalProgressMessage {
    margin: 0 0 var(--space-xs) 0;
    font-size: 0.9em;
    font-weight: 500;
    color: var(--text-main);
}

#downloadModalProgressBar {
    width: 100%;
    height: 8px;
    accent-color: var(--sacred-gold);
}

.modal-footer {
    padding-top: var(--space-md);
    border-top: 1px solid var(--border-light);
    text-align: right;
}

/* Dark Mode Adjustments for Modal */
body.dark-mode .download-language-group {
    border-color: var(--border-main);
}
body.dark-mode .modal-header, body.dark-mode .modal-footer {
    border-color: var(--border-main);
}
body.dark-mode .download-option-item {
    border-bottom-color: var(--border-main);
}


/* --- Responsive Adjustments --- */
@media (max-width: 767px) {
    .view-tabs-container { display: none; }
    .bottom-nav { display: flex; }
    /* MODIFIED: Adjusted main-app-content padding-top for mobile now that header is gone */
    .main-app-content { padding-top: var(--space-md); padding-bottom: 70px; padding-left: var(--space-sm); padding-right: var(--space-sm); } /* Adjust padding */

    .settings-item { flex-direction: column; align-items: stretch; gap: var(--space-sm); }
    .settings-item > div:first-child { flex-basis: auto; }
    .setting-control { margin-left: 0; min-width: 0; text-align: left; width: 100%; }
    .setting-control select, .setting-control.range-control { width: 100%; min-width: 0; }
    .setting-control #fontSizeValue { min-width: auto; text-align: left; margin-left: var(--space-sm); }
    .settings-section button.link-button, .settings-section button.button-secondary { text-align: left; width: auto; display: inline-block; }
    .reading-header h2 { font-size: 1.1rem; }
    #crossRefBackButtonContainer { padding-left: var(--space-sm); }
    #crossRefBackButton { max-width: 120px; font-size: 0.8rem; }
    .reading-controls button { padding: var(--space-xs); font-size: 0.8rem; }
    .reading-controls button .visually-hidden { display: none; }
    .nav-btn { padding: var(--space-sm) var(--space-md); }
    .cross-ref-expansion { margin-left: 0.5em; max-width: calc(100% - 0.5em); font-size: 0.9em; }
    .cross-ref-expansion li { flex-direction: column; align-items: stretch; gap: var(--space-xs); }
    .go-to-ref-button { margin-top: var(--space-sm); align-self: flex-end; width: auto; }
    .close-expansion-button { font-size: 1.4rem; width: 24px; height: 24px; line-height: 24px; top: var(--space-xs); right: var(--space-xs); }
    /* Reflection cards on mobile */
    .reflection-card-header { padding: var(--space-xs) var(--space-sm); /* Less padding */ }
    .reflection-date { font-size: 0.8em; }
    .reflection-card-controls button { width: 24px; height: 24px; line-height: 24px; font-size: 1.2rem; padding: 0; } /* Make delete button smaller */
    .save-reflection-button { font-size: 0.8em; padding: var(--space-xs); }
    .reflection-content-display { padding: var(--space-sm); }
    .reflection-textarea { padding: var(--space-sm); font-size: 0.95em; }

    /* Data Management section on mobile */
    .settings-item-trigger { padding: var(--space-sm); /* Smaller padding on mobile trigger */ }
    #dataManagementOptions:not(.hidden) {
         padding-left: var(--space-sm); /* Adjust padding inside options */
         padding-right: var(--space-sm);
         padding-top: var(--space-sm); /* Less padding on mobile */
         padding-bottom: var(--space-sm);
         max-height: 400px; /* Adjust max-height if needed for mobile */
         overflow-y: auto; /* Allow vertical scrolling if content exceeds max-height */
         /* Scrollbar styles will be inherited from desktop, or you can specify mobile-specific ones here */
    }
body.dark-mode #dataManagementOptions:not(.hidden) {
    scrollbar-color: var(--border-accent) rgba(255,255,255,0.05); /* Dark mode scrollbar color for Firefox */
}
body.dark-mode #dataManagementOptions:not(.hidden)::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.05); /* Dark mode track */
}
body.dark-mode #dataManagementOptions:not(.hidden)::-webkit-scrollbar-thumb {
    /* Thumb color (var(--border-accent)) is usually fine for both modes */
    /* border-color can match the dark mode card background for consistency */
    border: 1px solid var(--bg-card); /* Dark mode thumb border, using --bg-card from dark theme */
}
     #dataManagementOptions .setting-item {
          padding: var(--space-sm) 0; /* Adjust vertical padding */
     }
     #dataManagementOptions .setting-item:last-child {
          padding-bottom: 0;
     }
}


/* --- Reflection Feature Styles --- */

/* Toolbar for Add Button */
.reflection-toolbar {
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--border-main);
    margin-bottom: var(--space-md);
    text-align: left; /* Align button left */
}

/* Add New Button */
#addNewReflectionButton {
    display: inline-flex;
    align-items: center;
    /* Uses app's button-primary styles */
}
#addNewReflectionButton .icon {
    margin-right: var(--space-xs);
    font-size: 1.2em;
    line-height: 1;
}

/* Add Reflection Form (Block containing textarea and floating buttons) */
#addReflectionForm {
    display: none; /* Hidden by default */
    margin-bottom: var(--space-md);
    padding: 0; /* No padding here */
    background-color: var(--bg-subtle); /* Background for the whole form area */
    border: none; /* No border on the form container */
    border-radius: 8px;
    position: relative; /* Needed for absolute positioning of buttons */
}
 #addReflectionForm.visible {
     display: block;
 }

/* Textarea for the Add Form */
#addReflectionForm textarea {
    width: 100%;
    /* Padding for text content, considering space for floating buttons */
    padding: var(--space-md);
    /* Adjust padding-right and padding-bottom based on desired button area size */
    padding-right: calc(var(--space-md) + 100px); /* Approx. space for 2 buttons + gap + padding */
    padding-bottom: calc(var(--space-md) + 50px); /* Approx. space for button height + padding */

    border: none; /* Remove border */
    border-radius: 8px; /* Apply radius to the textarea itself */
    min-height: 500px; /* Increased minimum height */
    font-family: var(--font-reading);
    font-size: 1em;
    line-height: 1.7;
    resize: vertical;
    margin-bottom: 0; /* Remove margin */

    background-color: var(--bg-card); /* Background matching card for the text area */
    color: var(--text-main);
    outline: none;
}
 #addReflectionForm textarea:focus-visible {
     box-shadow: inset 0 0 0 1px var(--border-accent);
 }
 body.dark-mode #addReflectionForm textarea:focus-visible {
     box-shadow: inset 0 0 0 1px var(--border-accent);
 }

/* Floating buttons container for the Add Form */
#addReflectionForm .form-buttons {
    position: absolute;
    bottom: var(--space-sm); /* Position relative to the form container */
    right: var(--space-sm);
     display: flex;
     justify-content: flex-end;
     gap: var(--space-sm);
     z-index: 10; /* Ensure buttons are above the textarea */
}

 /* Style for the floating buttons (both Save and Cancel) */
 #addReflectionForm .form-buttons button {
     display: inline-block;
     font-weight: 500;
     border-radius: 6px;
     cursor: pointer;
     transition: all var(--transition-fast);
     line-height: 1.4;
     white-space: nowrap;

     /* Subtle appearance */
     padding: var(--space-xs) var(--space-sm);
     font-size: 0.9rem;
     background: none; /* Transparent background */
     color: var(--text-muted); /* Muted color */
     border: 1px solid transparent;
 }
#addReflectionForm .form-buttons button:hover,
#addReflectionForm .form-buttons button:focus {
    background-color: var(--bg-button); /* Subtle background on hover */
    color: var(--link-color);
    border-color: var(--border-light);
}
 body.dark-mode #addReflectionForm .form-buttons button:hover,
 body.dark-mode #addReflectionForm .form-buttons button:focus {
     background-color: #333;
     color: var(--link-hover-color);
     border-color: #555;
 }
 /* Specific style for the Save button */
 #addReflectionForm .form-buttons .save-button {
     color: var(--sacred-gold); /* Highlight save button */
 }
 #addReflectionForm .form-buttons .save-button:hover,
 body.dark-mode #addReflectionForm .form-buttons .save-button:hover,
 #addReflectionForm .form-buttons .save-button:focus,
 body.dark-mode #addReflectionForm .form-buttons .save-button:focus {
     color: var(--sacred-gold);
      background-color: rgba(212, 175, 55, 0.1); /* Subtle gold background on hover */
      border-color: rgba(212, 175, 55, 0.2);
 }
 body.dark-mode #addReflectionForm .form-buttons .save-button:hover,
 body.dark-mode #addReflectionForm .form-buttons .save-button:focus {
      background-color: rgba(212, 175, 55, 0.15);
      border-color: rgba(212, 175, 55, 0.3);
 }


/* List Container - Matching user-item-list */
/* No specific CSS rule needed here, already defined for user-item-list */

/* Saved Reflection Card - Matching note-item, favourite-item */
.reflection-card {
    background-color: var(--bg-card);
    border: 1px solid var(--border-main);
    border-radius: 8px;
    margin-bottom: var(--space-md);
    position: relative;
    overflow: hidden; /* Crucial for max-height truncation */
    box-shadow: 0 2px 8px var(--shadow-color);
    transition: box-shadow var(--transition-fast), border-color var(--transition-fast);
}
 .reflection-card:hover {
     box-shadow: 0 4px 12px var(--shadow-color);
     border-color: var(--border-light);
 }

/* Card Header (for date/time) - Matching item-header */
.reflection-card-header {
    padding: var(--space-sm) var(--space-md);
    background-color: var(--bg-subtle);
    border-bottom: 1px solid var(--border-light);
    font-size: 0.9em;
    color: var(--text-muted);
    display: flex;
    justify-content: space-between;
    align-items: center;
     cursor: pointer;
}
 body.dark-mode .reflection-card-header {
     background-color: #303030;
     border-bottom-color: var(--border-main);
     color: var(--text-muted);
 }


/* Reflection Date Span - Matching item-date */
.reflection-date {
     font-size: 1em;
     color: var(--text-muted);
     font-weight: normal;
     white-space: nowrap; /* Prevent date/time from wrapping */
}

/* Reflection Content (Display Mode - Truncated/Scrollable) - Matching item-verse-text style */
.reflection-content-display {
    padding: var(--space-md);
    line-height: 1.7;
    font-family: var(--font-reading);
    font-size: 1em;
    color: var(--text-main);
     cursor: pointer;
     outline: none;
     position: relative; /* For the fade-out effect */
     /* Set max height and enable scrolling when NOT in editing mode */
     max-height: 6.8em; /* Example: about 4 lines @ line-height 1.7 */
     overflow-y: auto;
     /* Add transition for smooth height change */
     transition: max-height var(--transition-med) ease-out, padding-bottom var(--transition-med) ease-out;
     padding-bottom: 2em; /* Extra padding at the bottom for the fade */

     /* Add focus style */
     &:focus-visible {
         box-shadow: inset 0 0 0 2px var(--link-color);
     }
      body.dark-mode &:focus-visible {
           box-shadow: inset 0 0 0 2px var(--link-hover-color);
      }
}
/* Add a fade out gradient when truncated */
.reflection-content-display::after {
     content: '';
     position: absolute;
     bottom: 0;
     left: 0;
     right: 0;
     height: 2em; /* Height of the fade */
     background: linear-gradient(to bottom, transparent, var(--bg-card));
     pointer-events: none;
}
 /* Style for placeholder text */
 .empty-reflection-placeholder {
     color: var(--text-muted);
     font-style: italic;
 }


/* Styles when the card is EXPANDED */
.reflection-card.expanded .reflection-content-display {
     max-height: none; /* Remove max height */
     overflow-y: visible; /* Allow content to overflow normally */
     padding-bottom: var(--space-md); /* Restore normal bottom padding */
}
/* Hide the fade gradient when expanded */
.reflection-card.expanded .reflection-content-display::after {
    display: none;
}


/* Reflection Edit Form (The block containing textarea and floating buttons) */
.reflection-edit-form {
     display: none; /* Hidden by default */
     padding: 0; /* No padding here */
     position: relative; /* Needed for absolute positioning of buttons */
}

 .reflection-card.editing .reflection-edit-form {
     display: block;
     max-height: none;
     overflow-y: visible;
 }
 /* Hide content/buttons when editing */
 .reflection-card.editing .reflection-content-display {
     display: none;
 }


/* Textarea for the Edit Form */
.reflection-edit-form textarea {
    width: 100%;
     /* Padding for text content, considering space for floating buttons */
    padding: var(--space-md);
     /* Adjust padding-right and padding-bottom based on desired button area size */
    padding-right: calc(var(--space-md) + 100px); /* Keep consistent space for buttons */
    padding-bottom: calc(var(--space-md) + 50px); /* Keep consistent space for buttons */

    border: none; /* Remove border */
    border-radius: 0; /* Remove border-radius */

    min-height: 400px; /* Increased minimum height */
    font-family: var(--font-reading);
    font-size: 1em;
    line-height: 1.7;
    resize: vertical;
    margin-bottom: 0;

     background-color: var(--bg-subtle); /* Use app subtle background for editing */
     color: var(--text-main);
     outline: none;
}
.reflection-edit-form textarea:focus-visible {
     box-shadow: inset 0 0 0 1px var(--border-accent);
 }
 body.dark-mode .reflection-edit-form textarea:focus-visible {
     box-shadow: inset 0 0 0 1px var(--border-accent);
 }


/* Floating buttons container for the Edit Form */
.reflection-edit-form .form-buttons {
    position: absolute;
    bottom: var(--space-sm); /* Position relative to the edit form container */
    right: var(--space-sm);
     display: flex;
     justify-content: flex-end;
     gap: var(--space-sm);
     z-index: 10; /* Ensure buttons are above the textarea */
}
 /* Ensure buttons are visible only when the card is editing */
 .reflection-card:not(.editing) .reflection-edit-form .form-buttons {
     display: none;
 }

 /* Style for the floating buttons (both Save and Cancel) */
 .reflection-edit-form .form-buttons button {
     display: inline-block;
     font-weight: 500;
     border-radius: 6px;
     cursor: pointer;
     transition: all var(--transition-fast);
     line-height: 1.4;
     white-space: nowrap;

     /* Subtle appearance */
     padding: var(--space-xs) var(--space-sm);
     font-size: 0.9rem;
     background: none;
     color: var(--text-muted);
     border: 1px solid transparent;
 }
.reflection-edit-form .form-buttons button:hover,
.reflection-edit-form .form-buttons button:focus {
    background-color: var(--bg-button);
    color: var(--link-color);
    border-color: var(--border-light);
}
 body.dark-mode .reflection-edit-form .form-buttons button:hover,
 body.dark-mode .reflection-edit-form .form-buttons button:focus {
     background-color: #333;
     color: var(--link-hover-color);
     border-color: #555;
 }
 /* Specific style for the Save button */
 .reflection-edit-form .form-buttons .save-button {
     color: var(--sacred-gold);
 }
 .reflection-edit-form .form-buttons .save-button:hover,
 body.dark-mode .reflection-edit-form .form-buttons .save-button:hover,
 .reflection-edit-form .form-buttons .save-button:focus,
 body.dark-mode .reflection-edit-form .form-buttons .save-button:focus {
     color: var(--sacred-gold);
      background-color: rgba(212, 175, 55, 0.1);
      border-color: rgba(212, 175, 55, 0.2);
 }
 body.dark-mode .reflection-edit-form .form-buttons .save-button:hover,
 body.dark-mode .reflection-edit-form .form-buttons .save-button:focus {
      background-color: rgba(212, 175, 55, 0.15);
      border-color: rgba(212, 175, 55, 0.3);
 }


/* Icons (Edit, Delete) */
.reflection-icon-button {
    position: absolute;
    top: var(--space-xs);
    width: 32px;
    height: 32px;
    line-height: 32px;
    text-align: center;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.5rem;
    font-weight: 300;
    border-radius: 50%;
    transition: all var(--transition-fast);
    z-index: 5;
     padding: 0;
}
.reflection-icon-button:hover, .reflection-icon-button:focus {
     background-color: rgba(0,0,0,0.05);
}
 body.dark-mode .reflection-icon-button:hover, body.dark-mode .reflection-icon-button:focus {
     background-color: rgba(255,255,255,0.05);
 }
 *:focus .reflection-icon-button { /* Prevent default focus outline from interfering */
      outline: none;
 }


.edit-reflection-button {
    right: 40px; /* Position relative to delete button */
    color: var(--royal-purple);
}
.edit-reflection-button:hover, .edit-reflection-button:focus {
     background-color: rgba(93, 63, 211, 0.1);
     color: var(--prophet-blue);
}
 body.dark-mode .edit-reflection-button {
     color: #aabfff; /* Lighter purple */
 }
  body.dark-mode .edit-reflection-button:hover, body.dark-mode .edit-reflection-button:focus {
     background-color: rgba(170, 180, 255, 0.1);
     color: var(--testament-old); /* Ensure good contrast in dark mode */
  }


.delete-reflection-button {
    right: var(--space-xs); /* Position from right edge */
    color: var(--text-muted);
}
 .delete-reflection-button:hover, .delete-reflection-button:focus {
     color: var(--text-danger);
     background-color: rgba(139, 0, 0, 0.1); /* Light red bg */
 }
 body.dark-mode .delete-reflection-button:hover, body.dark-mode .delete-reflection-button:focus {
     color: var(--text-danger);
     background-color: rgba(255, 138, 138, 0.15); /* Light red bg */
 }

/* Adjust hide rule for icons when editing */
.reflection-card.editing .edit-reflection-button,
.reflection-card.editing .delete-reflection-button {
    display: none;
}


/* Empty List Message - Matching existing .empty-list-message */
/* No need to redefine entirely, just ensure it matches the existing app style */
/* .empty-list-message { ... } */


/* --- Responsive Adjustment for Reflections on Mobile --- */
@media (max-width: 767px) {
    /* Ensure styles match existing mobile adjustments */

    /* Toolbar */
    .reflection-toolbar {
         /* Inherits from parent */
    }

    /* Add Form Textarea */
    #addReflectionForm textarea {
         /* Adjust padding for floating buttons on smaller screens */
        padding-right: calc(var(--space-sm) + 90px); /* Smaller space */
        padding-bottom: calc(var(--space-sm) + 40px); /* Smaller space */
         min-height: 200px; /* Adjust min-height for mobile */
    }

    /* Add Form Floating Buttons */
    #addReflectionForm .form-buttons {
         bottom: var(--space-xs); /* Closer to bottom */
         right: var(--space-xs); /* Closer to right */
         gap: var(--space-xs); /* Smaller gap */
    }
    #addReflectionForm .form-buttons button {
         font-size: 0.8rem; /* Smaller font */
         padding: var(--space-xs); /* Smaller padding */
    }


    /* Reflection Card Header */
    .reflection-card-header {
        padding: var(--space-xs) var(--space-sm); /* Less padding */
        font-size: 0.85em; /* Slightly smaller font */
    }

    /* Reflection Date */
    .reflection-date {
         font-size: 1em; /* Keep relative size */
    }

    /* Icon Buttons (Edit/Delete) */
    .reflection-icon-button {
        width: 28px; /* Smaller touch target */
        height: 28px;
        line-height: 28px;
        font-size: 1.4rem; /* Smaller icon size */
    }
     .edit-reflection-button {
         right: 34px; /* Adjust position based on new delete button size */
     }
     .delete-reflection-button {
         right: var(--space-xs); /* Keep position */
     }


    /* Reflection Content Display */
    .reflection-content-display {
         padding: var(--space-sm); /* Less padding */
         font-size: 0.95em; /* Slightly smaller text */
          max-height: 6em; /* Adjust max height if needed */
         padding-bottom: 1.5em; /* Adjust fade height */
    }
     .reflection-content-display::after {
         height: 1.5em; /* Adjust fade height */
     }
     .reflection-card.expanded .reflection-content-display {
         padding-bottom: var(--space-sm); /* Restore padding */
     }


    /* Reflection Edit Form Textarea */
    .reflection-edit-form textarea {
         padding: var(--space-sm); /* Less padding */
         font-size: 0.95em; /* Match display font size */
         padding-right: calc(var(--space-sm) + 90px); /* Match add form */
         padding-bottom: calc(var(--space-sm) + 40px); /* Match add form */
         min-height: 200px; /* Match add form min-height */
    }

    /* Reflection Edit Form Floating Buttons */
     .reflection-edit-form .form-buttons {
         bottom: var(--space-xs); /* Match add form */
         right: var(--space-xs); /* Match add form */
         gap: var(--space-xs); /* Match add form */
     }
     .reflection-edit-form .form-buttons button {
         font-size: 0.8rem; /* Match add form */
         padding: var(--space-xs); /* Match add form */
     }
}



/* --- START: Styles for Verse Card and Fullscreen Modal (Added for Supabase Integration) --- */

/* Reset/Base Styles (These are from the original snippet, included for completeness but might overlap with your main styles) */
/* You may want to review if these specific overrides are necessary or if your main styles are sufficient */
/*
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  background-color: #121212; // This will be overridden by your main body styles
  display: flex; // This will likely conflict with your main body styles
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  font-family: 'Roboto', sans-serif; // This will be overridden by your main body styles
  color: #e0e0e0; // This will be overridden by your main body styles
  padding: 20px;
}
*/


/* Verse Card Container (within Theme View) */
.verse-card {
  background: #1e0b36; /* Dark Purple */
  border: 1px solid #00ffaa; /* Bright Green */
  border-radius: 8px;
  padding: 10px 20px;
  max-width: 100%; /* Allow it to take max width of its container */
  width: 100%;
  box-shadow: 0 0 15px rgba(0, 255, 170, 0.3);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  position: relative; /* For positioning the menu dots */
  cursor: pointer;
  margin-bottom: var(--space-lg);
  z-index: 100; /* ADDED: Ensure verse card is above other theme cards */
}

.verse-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 0 25px rgba(0, 255, 170, 0.5);
}

/* Verse Card Title */
.verse-title {
  font-family: 'Montserrat', sans-serif; /* Requires Montserrat font link */
  color: #00ffaa; /* Bright Green */
  text-align: center;
  text-transform: uppercase;
  letter-spacing: 2px;
  font-size: 1em;
  margin-bottom: 10px;
  border-bottom: 1px solid rgba(0, 255, 170, 0.3);
  padding-bottom: 6px;
}

/* Verse Card Text */
.verse-text {
  line-height: 1.5;
  margin-bottom: 10px;
  font-weight: 300;
  font-size: 0.95em;
  
}

/* Verse Card Reference */
.verse-reference {
  text-align: right;
  font-style: italic;
  color: #9b59b6; /* Purple */
  opacity: 0.9;
  font-size: 0.85em;
}
/* NEW: Specific style for verse text inside the Verse of the Day card */
/* This ensures it's white regardless of light/dark mode, complementing the VOD card's dark background */
.verse-card .verse-text {
    color: white;
}

/* Menu Wrapper (already in style.css, ensure position:relative) */
.menu-wrapper {
    position: relative; /* Keep this */
    z-index: 50; /* Ensure the wrapper and its children stack above theme cards */
}

/* Menu Dots for Verse Card */
.menu-dots {
  position: absolute; /* Keep position absolute relative to wrapper */
  top: 12px; /* Keep original positioning */
  right: 15px; /* Keep original positioning */
  cursor: pointer;
  /* MODIFIED: Match font-size and color alpha from example */
  color: rgba(255, 255, 255, 0.7); /* Changed from 0.6 */
  font-size: 2em; /* Changed from 1.2em */
  user-select: none;
  z-index: 10;
}

.menu-dots:hover {
  color: #00ffaa; /* Bright Green */
}

/* Dropdown Menu for Verse Card */
.dropdown-menu {
  position: absolute;
  /* MODIFIED: Keep right: 0; for edge case handling */
  /* REMOVED: left: 50%; transform: translateX(-50%); */
  right: 0; /* Keep original positioning for edge case handling */

  top: 40px; /* MODIFIED: Match example's top spacing */
  /* Keep initial transform for animation, but remove translateX part */
  transform: translateY(-10px); /* Changed from translateY(-10px) translateX(-50%) */

  background: #1e0b36; /* Dark Purple */
  border: 1px solid #00ffaa; /* Bright Green */
  border-radius: 6px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  /* MODIFIED: Match width from example */
  width: 200px; /* Changed from 180px */
  opacity: 0;
  visibility: hidden;
  /* Keep existing transition property */
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1);
 
}
.dropdown-menu.active {
  opacity: 1;
  visibility: visible;
  /* Keep active transform, but remove translateX part */
  transform: translateY(0); /* Changed from translateY(0) translateX(-50%) */
}

/* Menu Items within Dropdown */
.menu-item {
  /* MODIFIED: Match padding from example */
  padding: 12px 16px; /* Changed from 10px 16px */
  color: #e0e0e0; /* Light Gray */
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.2s ease;
  border-bottom: 1px solid rgba(0, 255, 170, 0.1);
    /* Add button reset styles */
  font-family: inherit; /* Inherit font */
  font-size: inherit; /* Inherit font size */
  background: none; /* Remove default button background */
  text-align: left; /* Align text left */
  width: 100%; /* Take full width */
  outline: none; /* Remove default outline */
}
.menu-item:focus-visible {
    outline: 2px solid #00ffaa; /* Custom focus style */
    outline-offset: -2px; /* Draw inside */
    box-shadow: 0 0 0 2px rgba(0, 255, 170, 0.3); /* Add box shadow */
}
body.dark-mode .menu-item:focus-visible {
    outline-color: #00ffaa;
    box-shadow: 0 0 0 2px rgba(0, 255, 170, 0.4);
}


.menu-item:last-child {
  border-bottom: none;
}

.menu-item:hover {
  background: rgba(0, 255, 170, 0.1); /* Semi-transparent Bright Green */
  color: #00ffaa; /* Bright Green */
  /* MODIFIED: Match padding-left from example */
  padding-left: 22px; /* Changed from 20px */
}

/* Icon within Menu Item */
.menu-item i {
  font-size: 1em;
  width: 20px; /* Give icons consistent width */
  text-align: center;
}
/* Ensure icons inherit color */
.menu-item:hover i {
    color: inherit;
}


/* Fullscreen Verse Overlay (Modal) */
.fullscreen-verse {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(10, 6, 24, 0.95); /* Dark background with transparency */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 100; /* High z-index to be above everything */
  opacity: 0;
  pointer-events: none; /* Allow clicks to pass through when hidden */
  transition: opacity 0.4s ease;
}

.fullscreen-verse.active {
  opacity: 1;
  pointer-events: all; /* Enable clicks when visible */
}

/* Fullscreen Content Box */
.fullscreen-content {
  background: #1e0b36; /* Dark Purple */
  border: 2px solid #00ffaa; /* Bright Green */
  border-radius: 10px;
  padding: 40px;
  max-width: 600px;
  width: 90%; /* Responsive width */
  position: relative;
  box-shadow: 0 0 30px rgba(0, 255, 170, 0.7);
  transform: scale(0.95); /* Start slightly smaller for animation */
  transition: transform 0.4s ease;
}

.fullscreen-verse.active .fullscreen-content {
  transform: scale(1); /* Scale up when active */
}

/* Close Button for Fullscreen */
.close-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  color: rgba(255, 255, 255, 0.6);
  font-size: 1.5em;
  cursor: pointer;
  user-select: none;
    background: none; /* Button reset */
    border: none; /* Button reset */
    padding: 0; /* Button reset */
}

.close-btn:hover {
  color: #00ffaa; /* Bright Green */
}


/* --- Action Bar and Verse Highlighting Styles (Added) --- */

/* Basic Reset and Body Styling adjustments for padding */
/* Ensure padding-bottom is added to the body to prevent content being hidden by the fixed bar */
body {
    /*
       Add or update this property in your existing body styles.
       The value should be slightly more than the height of your action bar.
       Adjust '90px' if you change the bar's vertical padding or button padding.
    */
    padding-bottom: 90px;
    /* Keep your other body styles here */
    -webkit-font-smoothing: antialiased; /* Improve text rendering */
    -moz-osx-font-smoothing: grayscale;
}

/* Reading Area */
/*
   Your existing styles for the reading content container (#readingContent)
   should likely serve this purpose. Ensure it has appropriate max-width and margin.
*/
/* Example (adjust or merge with your #readingContent styles):
.reading-area {
     max-width: 700px;
     margin: 0 auto;
}
*/


/* Verse Paragraphs */
/* Apply these styles to the elements containing individual verses (likely your <p> tags in #readingContent) */
/* Merge with any existing styles you have for these elements */
.verse-paragraph {
    margin-bottom: 15px; /* Adjust space between verses as needed */
    padding: 5px; /* Padding around the verse text itself */
    cursor: pointer;
    transition: background-color 0.15s ease-in-out; /* Smooth highlight transition */
    border-bottom: 1px dashed transparent; /* Base style for the underline effect */
    border-radius: 4px; /* Subtle rounded corners for the background highlight */
}
/* Hover effect for verses */
.verse-paragraph:hover {
    /* MODIFIED: Use variable for background color */
    background-color: var(--verse-hover-bg); /* Theme-aware hover state color */
}

/* Style for the Selected Verse(s) */
.verse-paragraph.selected {
    /* MODIFIED: Use variables for background and border */
    /* TEMPORARILY ADD !important FOR TESTING */
    background-color: var(--selection-bg) !important; /* Background highlight color when selected */
    border-bottom-color: var(--selection-border) !important; /* Color of the underline/border when selected */
    border-bottom-style: solid; /* Make the underline solid when selected */

    /* Keep other styles from the original block */
    transition: background-color 0.15s ease-in-out; /* Smooth highlight transition */
    border-radius: 4px; /* Subtle rounded corners for the background highlight */
    /* Note: Border is applied via border-bottom-color */
}

/* --- Action Bar Styles --- */

/* Container for the entire action bar */
.action-bar-container {
    position: fixed; /* Stay fixed at the bottom of the viewport */
    bottom: 0;
    left: 0;
    right: 0;
    /* Modern background with subtle gradient - Adjust colors */
    background: linear-gradient(to top, rgba(52, 58, 64, 0.95), rgba(52, 58, 64, 0.85));
    color: #dee2e6; /* Text/icon color on the bar - Adjust color */
    padding: 12px 0; /* Vertical padding, horizontal padding handled by inner container */
    box-shadow: 0 -6px 12px rgba(0, 0, 0, 0.4); /* Prominent shadow at the top */
    transition: transform 0.3s ease-out; /* Smooth slide animation */
    z-index: 1000; /* Ensure it's on top of other content */
    /* Optional: Backdrop filter for blur effect (modern browsers) */
    backdrop-filter: blur(8px); /* Blur content behind the bar */
    -webkit-backdrop-filter: blur(8px); /* Safari support */
    /* Fallback for browsers that don't support backdrop-filter */
    background-color: rgba(52, 58, 64, 0.9); /* Semi-transparent solid color fallback - Adjust color */
}

/* Hidden state for the slide-out animation */
.action-bar-container.hidden {
    transform: translateY(100%); /* Move off-screen downwards */
}

/* Container directly holding the action buttons (uses flexbox) */
.action-buttons-container {
    display: flex; /* Arrange buttons horizontally */
    width: 100%; /* Fill the container width */
    justify-content: space-around; /* Distribute space evenly around/between items */
    padding: 0 15px; /* Horizontal padding inside the bar - Adjust as needed */
    box-sizing: border-box; /* Include padding in the element's total width */
}

/* Individual Action Button Styling */
.action-buttons-container button {
    flex: 1 1 auto; /* Allow buttons to grow and shrink, distributing space */
    min-width: 0; /* Allow buttons to shrink below their default content size if necessary */
    background: none; /* No background fill */
    border: none; /* No border */
    color: inherit; /* Inherit text/icon color from .action-bar-container */
    font-size: 0.75em; /* Base font size for the text label, icons are sized relative to this */
    cursor: pointer; /* Indicate clickable */
    padding: 8px 0; /* Vertical padding for the button area */
    border-radius: 6px; /* Rounded corners for the button area */
    transition: background-color 0.2s ease-in-out, transform 0.1s ease-out; /* Smooth hover/focus effects */
    display: flex; /* Use flexbox to layout icon and text */
    flex-direction: column; /* Stack icon and text vertically */
    align-items: center; /* Center icon and text horizontally within the button */
    text-align: center; /* Center the text label */
    white-space: nowrap; /* Prevent the text label from wrapping */
    opacity: 0.9; /* Slightly transparent when not hovered/focused */
}

/* Styling for the icon within the button */
.action-buttons-container button i {
    font-size: 1.6em; /* Size of the icon, relative to the button's font-size (0.75em * 1.6 = 1.2em actual size) */
    margin-bottom: 5px; /* Space between the icon and the text label */
    pointer-events: none; /* Ensures clicking the icon still triggers the button's click event */
}

/* Styling for the text label within the button */
.action-buttons-container button span {
    display: block; /* Ensure the span takes up space */
    font-size: 1em; /* Text label size relative to the button's font-size */
    font-weight: 500; /* Medium font weight */
}

/* Hover and Focus states for buttons */
.action-buttons-container button:hover,
.action-buttons-container button:focus {
    background-color: rgba(255, 255, 255, 0.15); /* Subtle semi-transparent white background on hover/focus - Adjust color */
    outline: none; /* Remove the default browser focus outline for a cleaner look */
    opacity: 1; /* Fully opaque on hover/focus */
    transform: scale(1.05); /* Slightly enlarge the button on hover/focus */
}

/* Add styling for an 'active' state if an action is toggleable (e.g., a highlight button) */
/* Example (adjust color):
.action-buttons-container button.active-action {
    color: #ffc107; // Example: Yellow accent for active state
}
*/

/* --- End Action Bar and Verse Highlighting Styles --- */


/* Styles for the Quick Action Button (Reading Header) */
.reading-quick-action-button.active {
    /* Example style to indicate the button is active */
    background-color: var(--color-primary); /* Use your theme's primary color */
    color: var(--color-primary-text); /* Use a contrasting text color */
    /* Add other styling like border, box-shadow etc. as needed for visual feedback */
}

/* Styles for the Commentary View (Full Chapter) */
.commentary-block {
    margin-bottom: 1.5em; /* Space between commentary blocks */
    padding: 0.8em 1.2em;
    border: 1px solid var(--color-border); /* Use your theme's border color variable */
    border-radius: 8px;
    background-color: var(--color-background-secondary); /* Use a slightly different background */
    /* Add styles for mobile responsiveness if needed */
    /* @media (max-width: 768px) { ... } */
}

.commentary-block .commentary-heading {
    font-size: 1.1em;
    margin-top: 0;
    margin-bottom: 0.5em;
    color: var(--color-heading); /* Use your theme's heading color */
    border-bottom: 1px solid var(--color-border-subtle); /* Lighter border */
    padding-bottom: 0.3em;
    word-break: break-word; /* Prevent long book names/references from overflowing */
}

.commentary-block .commentary-text {
    line-height: 1.6;
     color: var(--color-text);
    word-break: break-word; /* Prevent long words from overflowing */
}

.commentary-block .commentary-text p {
    margin: 0.5em 0;
    padding: 0;
}

.commentary-block .empty-commentary-placeholder {
     font-style: italic;
     color: var(--color-text-secondary); /* Use a muted color */
}


/* Styles for the Inline Commentary Expansion */
/* This should share many styles with .cross-ref-expansion */
.commentary-expansion {
    position: relative; /* Needed for close button positioning */
    margin: 0.5em 0 1.5em; /* Space above and below the panel */
    padding: 1em;
    border: 1px solid var(--color-accent); /* Use an accent color from your theme */
    border-radius: 8px;
    background-color: var(--color-background-secondary);
    overflow: hidden; /* Hide content initially */
    max-height: 0; /* Start collapsed */
    transition: max-height 0.3s ease-out, padding 0.3s ease-out, margin 0.3s ease-out;
    opacity: 0; /* Start hidden visually */
    transition-delay: 0.1s; /* Optional: delay opacity slightly on show */
    contain: layout style; /* Performance hint */
}

/* State when the panel is visible */
.commentary-expansion.visible {
    max-height: 500px; /* Arbitrary large value, js will set actual height based on scrollHeight */
    opacity: 1;
    transition-delay: 0s; /* Optional: no delay on show */
}

/* Style the header within the expansion */
.commentary-expansion-header {
     display: flex;
     justify-content: space-between;
     align-items: center;
     margin-bottom: 0.5em;
     border-bottom: 1px solid var(--color-border-subtle);
     padding-bottom: 0.5em;
}

.commentary-expansion-ref {
     font-weight: bold;
     color: var(--color-heading);
      word-break: break-word;
      flex-grow: 1; /* Allow reference to take space */
      padding-right: 10px; /* Space between ref and close button */
}

/* Reuse the existing close button style or define a similar one */
.commentary-expansion .close-expansion-button {
    /* Assume you have a general style for close buttons or copy from cross-ref */
    background: none;
    border: none;
    font-size: 1.2em;
    line-height: 1;
    cursor: pointer;
    color: var(--color-text-secondary); /* Or a specific close button color */
    padding: 0; /* Remove default button padding */
    flex-shrink: 0; /* Prevent shrinking */
}

.commentary-expansion .close-expansion-button:hover,
.commentary-expansion .close-expansion-button:focus {
    color: var(--color-text);
    outline: none;
}


.commentary-expansion-text {
     line-height: 1.6;
     color: var(--color-text);
     margin-bottom: 1em;
     max-height: 200px; /* Limit height initially, add scrollbar */
     overflow-y: auto;
     padding-right: 5px; /* Add padding for potential scrollbar */
     word-break: break-word; /* Prevent long words from overflowing */
}

/* Add a style to make the text not scrollable/limited height when expanded */
/* .commentary-expansion.expanded .commentary-expansion-text { */
     /* max-height: none; Remove max-height when the card itself is expanded */
     /* overflow-y: visible; */
/* } */


.commentary-expansion-text p {
    margin: 0.5em 0;
    padding: 0;
}


/* Style the footer within the expansion */
.commentary-expansion-footer {
     text-align: right;
     padding-top: 0.5em;
     border-top: 1px solid var(--color-border-subtle);
}

.commentary-expansion .go-to-full-commentary-button {
     /* Style as a small button */
     background-color: var(--color-button-bg);
     color: var(--color-button-text);
     border: 1px solid var(--color-button-border);
     padding: 0.4em 0.8em;
     border-radius: 4px;
     cursor: pointer;
     font-size: 0.9em;
     transition: opacity 0.2s ease;
}

.commentary-expansion .go-to-full-commentary-button:hover,
.commentary-expansion .go-to-full-commentary-button:focus {
     opacity: 0.9;
     outline: none;
}

.commentary-expansion .go-to-full-commentary-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Style for the temporary inline message */
.inline-info-message {
    margin: 0.5em 0 1em; /* Space above and below */
    padding: 0.5em 1em;
    background-color: var(--color-info-bg); /* Use an info color variable */
    color: var(--color-info-text); /* Use an info text color variable */
    border: 1px solid var(--color-info-border); /* Use an info border color variable */
    border-radius: 4px;
    font-size: 0.9em;
    opacity: 1;
    transition: opacity 0.5s ease-out;
    word-break: break-word;
}
.inline-info-message.removing {
    opacity: 0;
}

/* Add this to your CSS */
#actionBarDoneBtn {
    /* Example styling: */
    /* Ensure it's visible when the bar is visible */
    /* Its display is managed by JS for simplicity, but you could do it purely in CSS: */
    /* display: none; */
    /* .action-bar-container:not(.hidden) #actionBarDoneBtn { display: block; } */

    /* Add some margin to separate it */
    margin-right: 10px; /* Or adjust as needed */
    /* Basic button styling */
    padding: 8px 15px;
    border: 1px solid var(--color-border);
    background-color: var(--color-background-secondary);
    color: var(--color-text);
    border-radius: var(--border-radius);
    cursor: pointer;
    font-size: 0.9em;
}

#actionBarDoneBtn:hover {
     background-color: var(--color-hover);
}

#actionBarDoneBtn:active {
     background-color: var(--color-active);
}


/* Example: Style for disabled action buttons */
.action-bar-container button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Ensure the Done button is NOT styled as disabled even if its peer buttons are */
.action-bar-container button#actionBarDoneBtn:disabled {
     /* Override if needed, but its disabled state is managed explicitly not to be disabled */
     opacity: 1; /* Example: keep full opacity */
     cursor: pointer; /* Example: keep pointer cursor */
}

/* You might want to adjust the layout of .action-buttons-container to accommodate the new button */
.action-buttons-container {
     display: flex;
     gap: 10px; /* Example spacing between buttons */
     align-items: center;
     padding: 0 10px; /* Add some horizontal padding */
     overflow-x: auto; /* Allow horizontal scrolling if many buttons */
     /* Consider adding a scrollbar style if overflow is likely */
     scrollbar-width: thin; /* For Firefox */
     scrollbar-color: var(--color-border) transparent; /* For Firefox */
}

.action-buttons-container::-webkit-scrollbar {
  height: 5px; /* For Chrome, Safari */
}

.action-buttons-container::-webkit-scrollbar-track {
  background: transparent;
}

.action-buttons-container::-webkit-scrollbar-thumb {
  background-color: var(--color-border);
  border-radius: 5px;
}

/* Optional: Ensure verse numbers are clickable targets for double-tap */
.verse-paragraph .verse-number {
    pointer-events: none; /* Allow clicks to pass through to the parent <p> */
}
/* Correction: Actually, pointer-events: auto; on the verse number might be necessary
   if you want the click *specifically* on the number to register on the <p>
   or if you want the number itself to potentially be an interactive element later.
   Let's keep pointer-events: none; for simplicity so any click inside the <p>
   that isn't a cross-ref trigger registers as a click on the paragraph. */
/* .verse-paragraph .verse-number { pointer-events: auto; } */


/* --- START: Action Bar Scrollable Styles - Decorated --- */
.action-bar-container {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    /* Using a dark gradient background for the bar itself */
    background: linear-gradient(to top, rgba(29, 29, 29, 0.95), rgba(35, 35, 35, 0.85));
    color: var(--text-on-grad); /* Use text color suitable for dark backgrounds */
    padding: 12px 0;
    box-shadow: 0 -6px 15px rgba(0, 0, 0, 0.5); /* Stronger shadow */
    transition: transform 0.3s ease-out;
    z-index: 1000;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    /* Fallback to a solid dark background */
    background-color: #1d1d1d;
    display: flex;
    align-items: center;
}

body.dark-mode .action-bar-container {
     background: linear-gradient(to top, rgba(18, 18, 18, 0.95), rgba(26, 26, 26, 0.85));
     background-color: var(--bg-main);
     color: var(--text-on-grad);
     box-shadow: 0 -6px 15px rgba(0, 0, 0, 0.6);
}


.action-bar-container.hidden {
    transform: translateY(100%);
}

.action-buttons-container {
    display: flex;
    width: 100%;
    padding: 0 10px;
    box-sizing: border-box;
    overflow-x: auto;
    overflow-y: hidden;
    flex-wrap: nowrap;
    gap: 15px;
    scrollbar-width: thin;
    scrollbar-color: var(--text-muted) transparent; /* Scrollbar color */
}

.action-buttons-container::-webkit-scrollbar {
  height: 6px;
}

.action-buttons-container::-webkit-scrollbar-track {
  background: transparent;
}

.action-buttons-container::-webkit-scrollbar-thumb {
  background-color: var(--text-muted);
  border-radius: 3px;
}

.action-buttons-container button {
    flex: 0 0 auto;
    min-width: 60px;
    /* Enhanced button appearance */
    background-color: rgba(255, 255, 255, 0.08); /* Subtle semi-transparent background */
    border: 1px solid rgba(255, 255, 255, 0.1); /* Subtle border */
    color: var(--text-on-grad); /* Inherit light color from container */
    font-size: 0.75em;
    cursor: pointer;
    padding: 8px 0;
    border-radius: 6px;
    transition: background-color 0.2s ease-in-out, transform 0.1s ease-out, box-shadow 0.2s ease-in-out, border-color 0.2s ease-in-out;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    white-space: nowrap;
    opacity: 1; /* Start with full opacity */
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2); /* Subtle button shadow */
    outline: none;
}
body.dark-mode .action-buttons-container button {
     background-color: rgba(255, 255, 255, 0.08);
     border-color: rgba(255, 255, 255, 0.1);
     color: var(--text-on-grad);
     box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
}


.action-buttons-container button:hover:not(:disabled),
.action-buttons-container button:focus:not(:disabled) {
    background-color: rgba(212, 175, 55, 0.2); /* More prominent background on hover/focus (using accent) */
    border-color: var(--border-accent); /* Accent border on hover/focus */
    color: var(--border-accent); /* Accent color for text/icon */
    opacity: 1;
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 0 0 0 2px rgba(212, 175, 55, 0.2); /* Enhanced shadow and focus ring */
}
body.dark-mode .action-buttons-container button:hover:not(:disabled),
body.dark-mode .action-buttons-container button:focus:not(:disabled) {
    background-color: rgba(212, 175, 55, 0.3);
    border-color: var(--border-accent);
    color: var(--border-accent);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5), 0 0 0 2px rgba(212, 175, 55, 0.3);
}


.action-buttons-container button:disabled {
    opacity: 0.4; /* Dim disabled buttons more */
    cursor: not-allowed;
    transform: none;
    background-color: rgba(255, 255, 255, 0.05); /* Very subtle disabled background */
    border-color: rgba(255, 255, 255, 0.08);
    color: rgba(var(--text-on-grad-rgb, 255, 255, 255), 0.4); /* Dim text/icon color */
    box-shadow: none;
}
/* Define --text-on-grad-rgb if not already defined */
:root { --text-on-grad-rgb: 255, 255, 255; }


.action-buttons-container button i {
    font-size: 1.6em;
    margin-bottom: 5px;
    pointer-events: none;
}

.action-buttons-container button span {
    display: block;
    font-size: 1em;
    font-weight: 500;
}

/* Style for the "Done" button */
/* Using button-primary style with accent color for prominence */
#actionBarDoneBtn {
    flex-shrink: 0;
    margin-right: 10px;
    padding: 8px 15px;
    /* Using primary button variables */
    background-color: var(--bg-button-primary);
    color: var(--text-button-primary);
    border: 1px solid var(--border-primary);
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9em;
    font-weight: 600; /* Make Done button text a bit bolder */
    white-space: nowrap;
    transition: all 0.2s ease-in-out;
    align-self: center;
    opacity: 1;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2); /* Subtle shadow */
    outline: none;
}

#actionBarDoneBtn:hover,
#actionBarDoneBtn:focus {
    background-color: var(--bg-button-primary-hover);
    border-color: var(--bg-button-primary-hover);
    color: var(--text-button-primary);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    transform: none; /* Prevent scale on Done button */
}

/* Ensure the Done button doesn't get disabled styles */
.action-bar-container button#actionBarDoneBtn:disabled {
     opacity: 1;
     cursor: pointer;
     background-color: var(--bg-button-primary);
     border-color: var(--border-primary);
     color: var(--text-button-primary);
     box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
}

/* --- Chapter Introduction Styles (Adapted from Demo 2 Prototype) --- */
.chapter-introduction { /* This class is applied by the JS function renderChapterIntroduction */
    font-family: var(--font-header-intro, 'Noto Serif', serif); /* Use Noto Serif, fallback to generic serif */
    text-align: center;
    padding: var(--space-md) 0; /* Adjusted padding: less horizontal, more vertical for breathing room */
    /* background-color: transparent; */ /* Already transparent by default for divs */
    margin: 0 auto var(--space-lg); /* Center block, add space below, consistent with previous recommendation */
    max-width: 90%; /* Limit width, can adjust */
    position: relative; /* For the  pseudo-elements */
    transition: color var(--transition-time); /* For smooth color transition in dark mode */
}

/* The <p> tag holding the introduction text, created by JS */
.chapter-introduction .introduction-text { /* Target .introduction-text within .chapter-introduction */
    font-size: 1.1em; /* From your prototype */
    font-weight: 500; /* From your prototype */
    font-style: italic; /* From your prototype */
    margin: 0; /* From your prototype */
    line-height: 1.6; /* From your prototype */
    position: relative; /* For the ::before and ::after line decorators */
    display: inline-block; /* Crucial for lines to be relative to text width */
    padding: 0 var(--space-md); /* Horizontal padding around the text, from your prototype */
    color: var(--text-main); /* Default text color */
    transition: text-shadow var(--transition-time); /* For smooth text-shadow transition in dark mode */
}

/* Gold text in dark mode for the introduction text */
body.dark-mode .chapter-introduction .introduction-text {
    color: var(--sacred-gold); /* Brighter gold for dark mode, from your prototype */
    text-shadow: 0 0 4px rgba(212, 175, 55, 0.2); /* Subtle glow, from your prototype */
}

/* Decorative lines above and below the introduction text */
.chapter-introduction .introduction-text::before,
.chapter-introduction .introduction-text::after {
    content: "";
    display: block;
    width: 60px; /* Initial width from your prototype */
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--border-accent), transparent); /* Gradient line */
    margin: var(--space-sm) auto; /* Centered, with space from text */
    opacity: 0.8; /* From your prototype */
    transition: width var(--transition-time) ease-out, opacity var(--transition-time) ease-out, background var(--transition-time) ease-out;
}

/* Hover effects for the lines (applied when hovering the .chapter-introduction block) */
.chapter-introduction:hover .introduction-text::before,
.chapter-introduction:hover .introduction-text::after {
    width: 80px; /* Expanded width on hover, from your prototype */
    opacity: 1; /* Full opacity on hover */
    background: linear-gradient(90deg, transparent, var(--sacred-gold), transparent); /* Use sacred-gold from your light theme vars */
}

body.dark-mode .chapter-introduction:hover .introduction-text::before,
body.dark-mode .chapter-introduction:hover .introduction-text::after {
    background: linear-gradient(90deg, transparent, var(--sacred-gold-light), transparent); /* Use sacred-gold-light for dark mode hover */
}

/* Optional: Decorative corner elements () */
.chapter-introduction::before,
.chapter-introduction::after {
    content: ""; /* Diamond symbol from your prototype */
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    color: var(--border-accent); /* Use accent color */
    font-size: 0.8em; /* From your prototype */
    opacity: 0.6; /* From your prototype */
    /* Transition for these could be added if desired */
}

.chapter-introduction::before {
    left: var(--space-sm); /* Adjusted to var(--space-sm) for less extreme positioning */
}

.chapter-introduction::after {
    right: var(--space-sm); /* Adjusted to var(--space-sm) */
}

/* Responsive adjustments for the chapter introduction */
@media (max-width: 600px) {
    .chapter-introduction {
        padding: var(--space-sm) 0; /* Reduce vertical padding on mobile */
        margin-bottom: var(--space-md); /* Slightly less margin below on mobile */
    }

    .chapter-introduction .introduction-text {
        font-size: 1em; /* Slightly smaller text on mobile, from your prototype */
        padding: 0 var(--space-sm); /* Less horizontal padding for text on mobile */
    }

    /* Hide decorative corner elements on smaller screens, as per your prototype */
    .chapter-introduction::before,
    .chapter-introduction::after {
        display: none;
    }

    /* Optional: Make lines slightly smaller on mobile if needed */
    .chapter-introduction .introduction-text::before,
    .chapter-introduction .introduction-text::after {
        width: 50px;
    }
    .chapter-introduction:hover .introduction-text::before,
    .chapter-introduction:hover .introduction-text::after {
        width: 70px;
    }
}
/* --- End Chapter Introduction Styles --- */
/* ==========================================================================
   Toast Notification Styles
   ========================================================================== */

.toast-notification {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translate(-50%, 100%); /* Start below the screen */
    padding: 12px 20px;
    border-radius: 8px;
    background-color: #333;
    color: white;
    font-size: 0.9em;
    z-index: 10000;
    opacity: 0;
    transition: transform 0.4s ease-in-out, opacity 0.4s ease-in-out;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    text-align: center;
    max-width: 90%;
    pointer-events: none; /* Allow clicks to pass through */
}

.toast-notification.show {
    transform: translate(-50%, 0); /* Move to final position on screen */
    opacity: 1;
}

/* Style variations based on type */
.toast-notification.success {
    background-color: #28a745; /* Green */
}

.toast-notification.error {
    background-color: #dc3545; /* Red */
}

.toast-notification.warning {
    background-color: #ffc107; /* Yellow */
    color: #212529; /* Dark text for yellow bg */
}

.toast-notification.info {
    background-color: #17a2b8; /* Teal/Blue */
}


/* ==========================================================================
   Download Modal Styles
   ========================================================================== */

.download-modal-content {
    max-width: 600px;
    width: 90vw;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border-light);
    padding-bottom: var(--space-sm);
    margin-bottom: var(--space-sm);
}

.modal-title {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 500;
    color: var(--text-main);
}

.modal-description {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin: var(--space-sm) 0 var(--space-lg);
    line-height: 1.5;
}

.download-options-container {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
    margin-bottom: var(--space-lg);
}

.download-language-group {
    border: 1px solid var(--border-main);
    border-radius: 8px;
    padding: var(--space-sm) var(--space-md) var(--space-xs);
    margin: 0;
}

.download-language-group legend {
    padding: 0 var(--space-sm);
    font-weight: 600;
    color: var(--text-main);
}

.download-option-item {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-sm) 0;
    border-bottom: 1px solid var(--border-light);
}

.download-language-group .download-option-item:last-child {
    border-bottom: none;
}

.option-details {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
}

.option-title {
    font-weight: 500;
    color: var(--text-main);
}

.option-status {
    font-size: 0.8rem;
    font-style: italic;
    color: var(--text-muted);
}

/* Status Colors */
.option-status[data-status="downloaded"] {
    color: #28a745; /* Green */
    font-weight: 500;
}

.option-status[data-status="not_downloaded"] {
    color: var(--text-muted);
}

.option-status[data-status="error"] {
    color: var(--text-danger);
}

/* Modal Footer for buttons */
.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: var(--space-sm);
    padding-top: var(--space-md);
    border-top: 1px solid var(--border-light);
}




/* ==========================================================================
   Download Modal Styles
   ========================================================================== */

.download-modal-content {
    max-width: 600px;
    width: 90vw;
    max-height: 85vh;
    display: flex;
    flex-direction: column;
    padding: 0; /* Reset padding to handle scroll area */
    overflow: hidden; /* Ensure header/footer stick */
}

.download-modal-content .modal-header {
    padding: var(--space-lg);
    border-bottom: 1px solid var(--border-light);
    background-color: var(--bg-card);
}

.download-modal-content .modal-body {
    padding: var(--space-lg);
    overflow-y: auto;
}

body.dark-mode .download-modal-content .modal-header {
    border-bottom-color: var(--border-main);
}

.modal-title {
    margin: 0;
    font-size: 1.5em;
    font-weight: 600;
    color: var(--color-text-primary);
}

.modal-description {
    font-size: 0.9em;
    color: var(--color-text-secondary);
    margin: 8px 0 20px;
    line-height: 1.5;
}

.download-options-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.download-language-group {
    border: 1px solid var(--border-main);
    border-radius: 8px;
    padding: 12px 16px;
    margin: 0;
    background-color: var(--bg-subtle);
}

.download-language-group legend {
    padding: 0 8px;
    font-weight: 600;
    color: var(--color-text-primary);
}

.download-option-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 0;
    border-bottom: 1px solid var(--color-border-light);
}

.download-language-group .download-option-item:last-child {
    border-bottom: none;
}

.option-details {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
}

.option-title {
    font-weight: 500;
    color: var(--color-text-primary);
}

.option-status {
    font-size: 0.8em;
    font-style: italic;
    color: var(--color-text-tertiary);
}

/* Status Colors */
.option-status[data-status="downloaded"] {
    color: #28a745; /* Green */
    font-weight: 500;
}
.option-status[data-status="not_downloaded"] {
    color: var(--color-text-secondary);
}
.option-status[data-status="error"] {
    color: #dc3545; /* Red */
}

/* Progress Container inside Modal */
.download-progress-container {
    margin-top: 20px;
    padding: 12px;
    background-color: var(--color-background-offset);
    border-radius: 6px;
    border: 1px solid var(--color-border-light);
}

#downloadModalProgressMessage {
    margin: 0 0 8px 0;
    font-size: 0.9em;
    font-weight: 500;
}

#downloadModalProgressBar {
    width: 100%;
}
